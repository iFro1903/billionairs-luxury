class PushNotificationManager{constructor(){this.vapidPublicKey="BImYUR7FiZgYywJNjKzSiIkDPdotF5OX5E1h023JBKk4Yr6nSnIzq6OD5PDNKLSl-UK1xxoFFY4uWWPyNAJaoGs",this.subscription=null}isSupported(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}getPermissionStatus(){return this.isSupported()?Notification.permission:"unsupported"}async requestPermission(){if(!this.isSupported())return console.warn("Push notifications not supported"),!1;if("granted"===Notification.permission)return!0;if("denied"===Notification.permission)return console.warn("‚ùå Notification permission denied"),!1;try{return"granted"===await Notification.requestPermission()}catch(i){return console.error("Error requesting notification permission:",i),!1}}urlBase64ToUint8Array(i){const t=(i+"=".repeat((4-i.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}async subscribe(){if(!this.isSupported())throw new Error("Push notifications not supported");try{if(!await this.requestPermission())throw new Error("Notification permission denied");const i=await navigator.serviceWorker.ready;let t=await i.pushManager.getSubscription();return t||(t=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)})),this.subscription=t,await this.sendSubscriptionToServer(t),t}catch(i){throw console.error("‚ùå Failed to subscribe:",i),i}}async sendSubscriptionToServer(i){try{const t=sessionStorage.getItem("userEmail")||localStorage.getItem("userEmail")||null,r={"Content-Type":"application/json"};t&&(r["x-user-email"]=t);const s=await fetch("/api/push-subscribe",{method:"POST",headers:r,body:JSON.stringify({subscription:i.toJSON(),userAgent:navigator.userAgent,email:t})});if(!s.ok)throw new Error(`Server responded with ${s.status}`);return await s.json()}catch(i){throw console.error("‚ùå Failed to send subscription to server:",i),i}}async unsubscribe(){try{if(!this.subscription){const i=await navigator.serviceWorker.ready;this.subscription=await i.pushManager.getSubscription()}return!!this.subscription&&(await this.subscription.unsubscribe(),this.subscription=null,!0)}catch(i){throw console.error("‚ùå Failed to unsubscribe:",i),i}}async getSubscription(){try{const i=await navigator.serviceWorker.ready;return this.subscription=await i.pushManager.getSubscription(),this.subscription}catch(i){return console.error("Error getting subscription:",i),null}}async showTestNotification(){if(this.isSupported()){if("granted"!==Notification.permission&&await this.requestPermission(),"granted"===Notification.permission){(await navigator.serviceWorker.ready).showNotification("üéâ Test Notification",{body:"This is a test notification from BILLIONAIRS",icon:"/assets/images/icon-192x192.png",badge:"/assets/images/icon-72x72.png",tag:"test-notification",vibrate:[200,100,200]})}}else window.toast.info("Push notifications are not supported in this browser.",{title:"Not Supported"})}}window.pushManager=new PushNotificationManager;