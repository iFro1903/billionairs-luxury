const EasterEggSystem={userEmail:null,status:null,async init(e){e?(this.userEmail=e,await this.recordFirstAccess(),await this.checkStatus(),await this.trackDailyLogin(),this.startMonitoring()):console.warn("EasterEggSystem: No email provided, skipping init")},async recordFirstAccess(){try{await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"first_access"})})}catch(e){console.error("Error recording first access:",e)}},async checkStatus(){try{const e=await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"check_status"})});this.status=await e.json(),this.updateUI()}catch(e){console.error("Error checking status:",e)}},async trackDailyLogin(){try{const e=await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"daily_login"})}),t=await e.json();t.debug,this.status.loginStreak=t.loginStreak}catch(e){console.error("Error tracking daily login:",e)}},updateUI(){if(this.status)if(this.status.eyeUnlocked)this.showEye();else{if(this.status.eyeReady&&!this.status.eyeUnlocked){const e=document.getElementById("easterEgg");return void(e&&e.querySelector(".pyramid")?this.transformPyramidToEye():(this.showPyramid(),setTimeout(()=>{this.transformPyramidToEye()},2e3)))}this.status.showPyramid&&!this.status.pyramidUnlocked&&setTimeout(()=>{this.showPyramid()},8e3),this.status.pyramidUnlocked&&!this.status.eyeReady&&this.showPyramid()}},showPyramid(){if(!window.location.pathname.includes("the-hidden-door.html"))return;const e=document.createElement("div");e.className="easter-egg-container",e.id="easterEgg",e.innerHTML='<div class="pyramid"><div class="pyramid-glow"></div></div>',e.onclick=()=>this.openPyramid(),document.body.appendChild(e),e.style.opacity="0",e.style.transform="scale(0)",setTimeout(()=>{e.style.transition="all 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)",e.style.opacity="1",e.style.transform="scale(1)"},100)},async openPyramid(){try{const e=await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"open_pyramid"})});await e.json();await this.waitForI18n();const t=this.translate("THE PYRAMID"),s=[this.translate("The mark of power inverted lies."),this.translate("A single dawn must break before your eyes."),this.translate("Only those with patience and deep loyalty shall see"),this.translate("What lies beyond eternity.")].join("\n");this.showRiddle('<img src="assets/images/logo.png" alt="BILLIONAIRS">',t,s)}catch(e){console.error("Error opening pyramid:",e)}},transformPyramidToEye(){if(!window.location.pathname.includes("the-hidden-door.html"))return;const e=document.getElementById("easterEgg");if(e){const t=e.querySelector(".pyramid");t?(t.style.transition="opacity 1s ease-out, transform 1s ease-out",t.style.opacity="0",t.style.transform="scale(0.8) rotate(180deg)",setTimeout(()=>{e.innerHTML='\n                        <div class="eye" style="opacity: 0; transform: scale(0.8);">\n                        </div>\n                    ';const t=e.querySelector(".eye");setTimeout(()=>{t.style.transition="opacity 1s ease-in, transform 1s ease-in",t.style.opacity="1",t.style.transform="scale(1)"},50),e.onclick=()=>this.openEye()},1e3)):(e.innerHTML='<div class="eye"></div>',e.onclick=()=>this.openEye())}else this.showEye()},showEye(){if(!window.location.pathname.includes("the-hidden-door.html"))return;let e=document.getElementById("easterEgg");if(e)e.querySelector(".pyramid")&&(e.innerHTML='<div class="eye"></div>',e.onclick=()=>this.openEye());else{const e=document.createElement("div");e.className="easter-egg-container",e.id="easterEgg",e.innerHTML='<div class="eye"></div>',e.onclick=()=>this.openEye(),document.body.appendChild(e)}},async openEye(){if(this.userEmail){try{const e=await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"check_status"})});this.status=await e.json()}catch(e){console.error("Status refresh failed:",e)}if(this.status.chatUnlocked)this.showChat();else{try{await fetch("/api/easter-egg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.userEmail,action:"unlock_eye"})})}catch(e){console.error("Error recording eye open:",e)}try{await this.waitForI18n();const e=this.translate("THE ALL-SEEING EYE"),t=[this.translate("The eye now watches over you."),this.translate("When the next sun has risen and fallen,"),this.translate("The final door will open.")].join("\n");this.showRiddle('<img src="assets/images/eye-simple.svg" alt="All-Seeing Eye" style="width: 80px; height: 80px;">',e,t)}catch(e){console.error("Error opening eye:",e)}}}else console.warn("EasterEggSystem: No email, cannot open eye")},showRiddle(e,t,s,i){const a=document.createElement("div");a.className="riddle-modal show";const n=this.translate("I UNDERSTAND");a.innerHTML=`\n            <div class="riddle-content">\n                <div class="riddle-icon">${e}</div>\n                <h2 class="riddle-title">${t}</h2>\n                <p class="riddle-text">${s}</p>\n                <button class="riddle-close">\n                    ${n}\n                </button>\n            </div>\n        `,a.querySelector(".riddle-close").addEventListener("click",()=>{a.remove(),"function"==typeof i&&i()}),document.body.appendChild(a)},async waitForI18n(){let e=0;for(;!window.i18n&&e<50;)await new Promise(e=>setTimeout(e,100)),e++},translate(e){if(!window.i18n)return console.warn(`⚠️ i18n not available, using fallback for: "${e}"`),e;try{const t=window.i18n.currentLang||"en";if(window.i18n.translations&&window.i18n.translations[t]){const s=e.split(".");let i=window.i18n.translations[t];for(const e of s){if(!i||"object"!=typeof i){i=void 0;break}i=i[e]}if(i&&"string"==typeof i)return i}const s=window.i18n.getTextMapForLanguage(t);if(s&&s[e]){return s[e]}return console.warn(`⚠️ No translation found for: "${e}" in language: ${t}`),e}catch(t){return console.error(`❌ Translation error for "${e}":`,t),e}},showChat(){if("undefined"==typeof LuxuryChat)return sessionStorage.setItem("openChatOnLoad","true"),void(window.location.href="/the-hidden-door.html");window.luxuryChat||(window.luxuryChat=new LuxuryChat,window.luxuryChat.init(this.userEmail)),window.luxuryChat.open()},startMonitoring(){setInterval(()=>{this.checkStatus()},6e4)}};