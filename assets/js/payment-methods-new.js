class PaymentMethodSelector{constructor(){this.selectedMethod="card",this.selectedCrypto="btc",this.init()}init(){document.querySelectorAll(".payment-method").forEach(e=>{e.addEventListener("click",e=>{this.selectPaymentMethod(e.currentTarget.dataset.method)})});document.querySelectorAll(".crypto-option").forEach(e=>{e.addEventListener("click",e=>{this.selectCrypto(e.currentTarget.dataset.crypto)})})}selectCrypto(e){document.querySelectorAll(".crypto-option").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-crypto="${e}"]`);t&&t.classList.add("active"),this.selectedCrypto=e}selectPaymentMethod(e){document.querySelectorAll(".payment-method").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-method="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".payment-form-section").forEach(e=>{e.classList.remove("active")});const r={card:"cardPaymentForm",wire:"wirePaymentForm",crypto:"cryptoPaymentForm"}[e];if(r){const e=document.getElementById(r);e&&e.classList.add("active")}this.selectedMethod=e}getSelectedPaymentData(){const e={method:this.selectedMethod,amount:5e7,currency:"chf"};switch(this.selectedMethod){case"card":e.paymentMethodTypes=["card"],e.description="Card Payment - 500,000 CHF",e.metadata={payment_tier:"millionaire",supports_amount:"500000_chf",processing_note:"May require bank authorization for amount"};break;case"wire":e.paymentMethodTypes=["wire_transfer"],e.description="Bank Wire Transfer - 500,000 CHF",e.requiresManualProcessing=!0,e.metadata={payment_tier:"millionaire",supports_amount:"unlimited",processing_type:"manual_wire_transfer",processing_note:"Bank details will be provided via email"};break;case"crypto":e.paymentMethodTypes=["crypto"],e.description=`Cryptocurrency Payment (${this.selectedCrypto.toUpperCase()}) - 500,000 CHF`,e.requiresManualProcessing=!0,e.selectedCrypto=this.selectedCrypto,e.metadata={payment_tier:"millionaire",supports_amount:"unlimited",processing_type:"cryptocurrency",crypto_currency:this.selectedCrypto,processing_time:"10-60_minutes",processing_note:"Crypto address will be provided via email"}}return e}getPaymentMethodInfo(){return{card:{name:"Credit/Debit Card",supports_500k:!0,limit:"Variable (bank-dependent)",processing_time:"Instant",note:"Requires bank authorization for high amounts",recommended:!0},wire:{name:"Bank Wire Transfer",supports_500k:!0,limit:"Unlimited",processing_time:"1-2 business days",note:"Most secure for very large amounts",recommended:!0},crypto:{name:"Cryptocurrency",supports_500k:!0,limit:"Unlimited",processing_time:"10-60 minutes",note:"Fast, private, and popular with tech millionaires",recommended:!0,currencies:["Bitcoin (BTC)","Ethereum (ETH)","Tether (USDT)"]}}[this.selectedMethod]||{}}async initiatePayment(){const e=this.getSelectedPaymentData();this.getPaymentMethodInfo();if("wire"===this.selectedMethod)return this.handleWireTransfer(e);if("crypto"===this.selectedMethod)return this.handleCryptoPayment(e);if(!window.stripeProcessor)throw console.error("❌ Stripe processor not available"),new Error("Payment processor not initialized");await window.stripeProcessor.createCheckoutSession("full",e)}async handleCryptoPayment(e){const t=`${document.getElementById("customerFirstName")?.value||""} ${document.getElementById("customerLastName")?.value||""}`.trim(),r=document.getElementById("customerEmail")?.value,o=document.getElementById("customerPhone")?.value,n=document.getElementById("customerCompany")?.value||"",a=document.getElementById("customerPassword")?.value,s=document.getElementById("customerPasswordConfirm")?.value;if(!(t&&r&&o&&a))return void window.toast.warning("Please fill in all required fields (First Name, Last Name, Email, Phone, Password)",{title:"Missing Fields"});if(a.length<8)return void window.toast.warning("Password must be at least 8 characters long",{title:"Password Too Short"});if(a!==s)return void window.toast.warning("Passwords do not match. Please check and try again.",{title:"Password Mismatch"});const i=this.selectedCrypto||"btc",c={...e,customer:{fullName:t,email:r,phone:o,company:n,password:a},cryptocurrency:i};return window.toast.success(`Crypto Payment Request Received!\nThank you, ${t}!\n\nCurrency: ${{btc:"Bitcoin (BTC)",eth:"Ethereum (ETH)",usdt:"Tether (USDT)"}[i]} · Amount: 500,000 CHF\nCheck your email at ${r} for wallet address and instructions.`,{title:"Payment Request Sent",duration:1e4}),c}async handleWireTransfer(e){const t=`${document.getElementById("customerFirstName")?.value||""} ${document.getElementById("customerLastName")?.value||""}`.trim(),r=document.getElementById("customerEmail")?.value,o=document.getElementById("customerPhone")?.value,n=document.getElementById("customerCompany")?.value||"",a=document.getElementById("customerPassword")?.value,s=document.getElementById("customerPasswordConfirm")?.value;if(t&&r&&o&&a)if(a.length<8)window.toast.warning("Password must be at least 8 characters long",{title:"Password Too Short"});else if(a===s)try{const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#fff;padding:2rem;border-radius:10px;z-index:10000;text-align:center;",e.innerHTML='<div style="width:40px;height:40px;border:3px solid rgba(201,169,110,0.2);border-top:3px solid #c9a96e;border-radius:50%;margin:0 auto 1rem;animation:spin 1s linear infinite;"></div><style>@keyframes spin{to{transform:rotate(360deg)}}</style><div style="color:rgba(255,255,255,0.8);font-size:0.9rem;letter-spacing:0.5px;">Processing wire transfer request...</div>',document.body.appendChild(e);const s=await fetch("/api/wire-transfer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:t,email:r,phone:o,company:n,password:a})}),i=await s.json();return document.body.removeChild(e),s.ok?(window.toast.success(`Wire Transfer Details Sent!\nThank you, ${t}!\n\nCheck your email: ${r}\nYou will receive bank details, reference number, and instructions.\nAmount: CHF 500,000.00`,{title:"Transfer Request Submitted",duration:1e4}),setTimeout(()=>{window.location.href="/login.html?registered=true"},3e3)):window.toast.error(`${i.error||i.message||"Failed to process wire transfer request"}. Please try again or contact support.`,{title:"Transfer Error"}),i}catch(e){throw console.error("Wire transfer error:",e),window.toast.error("Network error. Please check your connection and try again.",{title:"Connection Failed"}),e}else window.toast.warning("Passwords do not match. Please check and try again.",{title:"Password Mismatch"});else window.toast.warning("Please fill in all required fields (First Name, Last Name, Email, Phone, Password)",{title:"Missing Fields"})}}document.addEventListener("DOMContentLoaded",()=>{window.paymentMethodSelector=new PaymentMethodSelector}),window.PaymentMethodSelector=PaymentMethodSelector;