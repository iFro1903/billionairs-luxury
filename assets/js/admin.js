class AdminPanel{constructor(){this.ceoEmail="furkan_akaslan@hotmail.com",this.currentTab="users",this.users=[],this.autoRefreshTimer=null,this._cache={},this._cacheTTL=3e4,this.init()}debounce(e,t=300){let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,a),t)}}_cacheSet(e,t){this._cache[e]={data:t,ts:Date.now()}}_cacheGet(e){const t=this._cache[e];return t?Date.now()-t.ts>this._cacheTTL?(delete this._cache[e],null):t.data:null}_cacheInvalidate(e){e?delete this._cache[e]:this._cache={}}escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}toast(e,t="success",n=3500){const a=document.getElementById("toastContainer");if(!a)return void console.warn("Toast container missing");const s={success:"âœ…",error:"âŒ",warning:"âš ï¸",info:"â„¹ï¸"},i=document.createElement("div");i.className=`toast ${t}`,i.innerHTML=`\n            <span class="toast-icon">${s[t]||s.info}</span>\n            <span class="toast-body">${this.escapeHtml(e)}</span>\n            <button class="toast-close" aria-label="SchlieÃŸen">&times;</button>\n            <span class="toast-progress" style="animation-duration:${n}ms"></span>\n        `,i.querySelector(".toast-close").addEventListener("click",()=>this._removeToast(i)),a.appendChild(i),requestAnimationFrame(()=>requestAnimationFrame(()=>i.classList.add("show"))),setTimeout(()=>this._removeToast(i),n)}_removeToast(e){e&&!e._removing&&(e._removing=!0,e.classList.remove("show"),e.classList.add("hide"),setTimeout(()=>e.remove(),400))}_startInactivityTimer(){this._inactivityTimeout=6e5,this._inactivityWarning=54e4,this._activityEvents=["mousemove","mousedown","keydown","touchstart","scroll","click"],this._resetInactivity=()=>{clearTimeout(this._logoutTimer),clearTimeout(this._warningTimer);const e=document.getElementById("inactivityWarning");e&&e.remove(),this._warningTimer=setTimeout(()=>this._showInactivityWarning(),this._inactivityWarning),this._logoutTimer=setTimeout(()=>this._autoLogout(),this._inactivityTimeout)},this._activityEvents.forEach(e=>document.addEventListener(e,this._resetInactivity,{passive:!0})),this._resetInactivity()}_clearInactivityTimer(){clearTimeout(this._logoutTimer),clearTimeout(this._warningTimer),this._resetInactivity&&this._activityEvents.forEach(e=>document.removeEventListener(e,this._resetInactivity));const e=document.getElementById("inactivityWarning");e&&e.remove()}_showInactivityWarning(){if(document.getElementById("inactivityWarning"))return;const e=document.createElement("div");e.id="inactivityWarning",e.style.cssText="position:fixed;top:0;left:0;right:0;z-index:99999;background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;text-align:center;padding:12px 20px;font-size:14px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,0.4);animation:slideDown .3s ease;",e.innerHTML='Automatische Abmeldung in 1 Minute wegen Inaktivitaet â€” <span style="cursor:pointer;text-decoration:underline;" id="stayLoggedIn">Angemeldet bleiben</span>',document.body.appendChild(e),document.getElementById("stayLoggedIn")?.addEventListener("click",()=>{this._resetInactivity(),this.toast("Sitzung verlaengert","success")})}_autoLogout(){this._clearInactivityTimer(),sessionStorage.removeItem("adminSession");const e=document.createElement("div");e.style.cssText="position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:1rem;",e.innerHTML='<div style="color:#c9a96e;font-size:1.3rem;font-weight:700;">Sitzung abgelaufen</div><div style="color:rgba(255,255,255,0.6);font-size:0.9rem;">Automatische Abmeldung wegen Inaktivitaet</div>',document.body.appendChild(e),setTimeout(()=>location.reload(),2e3)}confirmDialog(e,t="âš ï¸"){return new Promise(n=>{document.querySelectorAll(".confirm-overlay").forEach(e=>e.remove());const a=document.createElement("div");a.className="confirm-overlay",a.style.cssText="position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;",a.innerHTML=`\n                <div class="confirm-dialog" style="pointer-events:auto;">\n                    <div class="confirm-icon">${t}</div>\n                    <div class="confirm-msg">${this.escapeHtml(e)}</div>\n                    <div class="confirm-actions">\n                        <button class="confirm-btn no">Abbrechen</button>\n                        <button class="confirm-btn yes">BestÃ¤tigen</button>\n                    </div>\n                </div>\n            `;let s=!1;const i=e=>{s||(s=!0,a.remove(),n(e))};a.querySelector(".confirm-btn.yes").addEventListener("click",e=>{e.stopPropagation(),i(!0)}),a.querySelector(".confirm-btn.no").addEventListener("click",e=>{e.stopPropagation(),i(!1)}),a.addEventListener("click",e=>{e.target===a&&i(!1)}),document.body.appendChild(a),a.querySelector(".confirm-btn.yes").focus()})}showLoading(e,t="Laden..."){if("string"==typeof e&&(e=document.querySelector(e)),!e)return;if(e.style.position=e.style.position||"relative",e.querySelector(".loading-overlay"))return;const n=document.createElement("div");n.className="loading-overlay",n.innerHTML=`<div class="loading-spinner"></div><span class="loading-text">${this.escapeHtml(t)}</span>`,e.appendChild(n)}hideLoading(e){if("string"==typeof e&&(e=document.querySelector(e)),!e)return;const t=e.querySelector(".loading-overlay");t&&t.remove()}formatTimeAgo(e){const t=Date.now()-e.getTime(),n=Math.floor(t/6e4),a=Math.floor(t/36e5),s=Math.floor(t/864e5);return n<1?"Gerade eben":n<60?`${n}m`:a<24?`${a}h`:s<7?`${s}d`:e.toLocaleDateString("de-DE")}getSession(){try{const e=JSON.parse(sessionStorage.getItem("adminSession"));return e?{email:e.email,token:e.token||""}:null}catch{return null}}setSession(e,t){sessionStorage.setItem("adminSession",JSON.stringify({email:e,token:t||""}))}authFetch(e,t={}){const n=this.getSession();if(n&&n.token){const a=t.headers||{};a.Authorization="Bearer "+n.token,t.headers=a}return t.credentials="include",fetch(e,t)}safeAttr(e){return String(e).replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getMembershipTimer(e,t,n){if(!t)return'<span style="color:#888;font-size:12px;">â€”</span>';const a=e?new Date(e):n?new Date(n):null;if(!a)return'<span style="color:#f39c12;font-size:12px;">Paid</span>';const s=new Date(a.getTime()+31536e6)-new Date;if(s<=0)return'<span style="color:#e74c3c;font-weight:600;">EXPIRED</span>';const i=Math.floor(s/864e5),o=Math.floor(s%864e5/36e5);let r="#2ecc71";i<=30?r="#e74c3c":i<=180&&(r="#f39c12");const l=Math.round(i/365*100);return`<div style="min-width:110px;">\n            <div style="font-size:12px;font-weight:700;color:${r};">${i}d ${o}h</div>\n            <div style="background:rgba(255,255,255,.1);border-radius:3px;height:4px;margin-top:3px;">\n                <div style="width:${l}%;height:100%;background:${r};border-radius:3px;"></div>\n            </div>\n            <div style="font-size:10px;color:#666;margin-top:1px;">${l}%</div>\n        </div>`}init(){const e=this.getSession();e&&e.email===this.ceoEmail?this.showDashboard(e.email):document.getElementById("adminLoginForm").addEventListener("submit",e=>{e.preventDefault(),this.handleLogin()})}async handleLogin(){const e=document.getElementById("adminEmail").value.toLowerCase().trim(),t=document.getElementById("adminPassword").value,n=document.getElementById("loginError");if(e===this.ceoEmail)try{const a=await fetch("/api/admin-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),s=await a.json();if(a.ok){if(s.requiresTwoFactor)return void this.show2FAPrompt(e,t);this.setSession(s.email,s.sessionToken),this.showDashboard(s.email)}else n.textContent=s.error||"Login fehlgeschlagen"}catch(e){console.error("Login error:",e),n.textContent="Verbindungsfehler"}else n.textContent="Zugang verweigert"}showDashboard(e){document.getElementById("adminLogin").classList.add("hidden"),document.getElementById("adminDashboard").classList.remove("hidden"),document.getElementById("adminUserName").textContent=e,this._startInactivityTimer(),document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",()=>this.switchTab(e.dataset.tab))}),document.getElementById("adminLogout").addEventListener("click",()=>{this._clearInactivityTimer(),sessionStorage.removeItem("adminSession"),location.reload()});const t=document.getElementById("menuToggle"),n=document.getElementById("sidebar"),a=this.createOverlay();t.addEventListener("click",()=>{n.classList.toggle("open"),a.classList.toggle("show")}),a.addEventListener("click",()=>{n.classList.remove("open"),a.classList.remove("show")}),document.getElementById("emergencyBtn").addEventListener("click",()=>this.toggleEmergencyMode());const s=document.getElementById("deleteAllUsersBtn");s&&s.addEventListener("click",()=>this.deleteAllUsers());const i=document.getElementById("createTestUsersBtn");i&&i.addEventListener("click",()=>this.createTestUsers());const o=document.getElementById("createMemberForm");o&&o.addEventListener("submit",e=>{e.preventDefault(),this.createMember()}),this.setupBulkEasterEggControls();const r=document.getElementById("csvExportBtn");r&&r.addEventListener("click",()=>this.exportCSV());const l=document.getElementById("refreshUsersBtn");l&&l.addEventListener("click",()=>{this._cacheInvalidate(),this.loadUsersData()});const d=document.getElementById("autoRefreshToggle");d&&d.addEventListener("change",e=>this.setAutoRefresh(e.target.checked));const c=document.getElementById("userSearch");c&&(this._debouncedFilter=this.debounce(()=>this.filterUsersTable(),300),c.addEventListener("input",()=>this._debouncedFilter()));const m=document.getElementById("userStatusFilter");m&&m.addEventListener("change",()=>this.filterUsersTable());const u=document.getElementById("closeModal");u&&u.addEventListener("click",()=>this.closeModal()),document.getElementById("memberModal")?.addEventListener("click",e=>{"memberModal"===e.target.id&&this.closeModal()}),this.checkEmergencyMode(),this.setupExportButtons(),this.setupBroadcastButton(),this.loadUsersData(),this.loadStatsData(),this.loadEnhancedAnalytics()}createOverlay(){let e=document.querySelector(".sidebar-overlay");return e||(e=document.createElement("div"),e.className="sidebar-overlay",document.body.appendChild(e)),e}switchTab(e){this.currentTab=e;document.getElementById("pageTitle").textContent={users:"Members","easter-eggs":"Easter Eggs",chat:"Chat",payments:"Payments",stats:"Statistics",security:"Security",audit:"Audit Logs"}[e]||e,document.querySelectorAll(".nav-item").forEach(t=>t.classList.toggle("active",t.dataset.tab===e)),document.querySelectorAll(".tab").forEach(t=>{const n=t.id===`tab-${e}`||t.id===`${e}Tab`;t.classList.toggle("active",n)}),document.getElementById("sidebar").classList.remove("open"),document.querySelector(".sidebar-overlay")?.classList.remove("show"),"users"!==e&&"easter-eggs"!==e||(this._cacheGet("users")?(this.renderUsersTable(this.users),this.renderIndividualUserControls(this.users)):this.loadUsersData()),"chat"===e&&(this._cacheGet("chat")||this.loadChatData()),"payments"===e&&(this._cacheGet("payments")||this.loadPaymentsData()),"stats"===e&&(this.loadStatsData(),this.loadEnhancedAnalytics()),"security"===e&&this.loadSecurityTab(),"audit"===e&&this.loadAuditTab()}setAutoRefresh(e){this.autoRefreshTimer&&(clearInterval(this.autoRefreshTimer),this.autoRefreshTimer=null),e&&(this.autoRefreshTimer=setInterval(()=>{"users"===this.currentTab?this.loadUsersData():"chat"===this.currentTab?this.loadChatData():"payments"===this.currentTab&&this.loadPaymentsData()},3e4))}async loadUsersData(){const e=document.querySelector("main");this.showLoading(e,"Lade Mitglieder...");try{const e=this.getSession(),t=await this.authFetch("/api/admin-users"),n=await t.json();this.users=n.users||[],document.getElementById("totalUsers").textContent=n.total||0,document.getElementById("paidUsers").textContent=n.paid||0,document.getElementById("activeUsers").textContent=n.active||0;const a=document.getElementById("freeUsers");a&&(a.textContent=(n.total||0)-(n.paid||0)),this.renderUsersTable(this.users),this.renderIndividualUserControls(this.users),this._cacheSet("users",!0)}catch(e){console.error("Error loading users:",e)}finally{this.hideLoading(document.querySelector("main"))}}renderUsersTable(e){const t=document.getElementById("usersTableBody");t&&(t.innerHTML="",e.forEach(e=>{const n=this.escapeHtml(e.email),a=this.escapeHtml(e.name||e.full_name||"â€”"),s=this.getMembershipTimer(e.paid_at,e.has_paid,e.created_at),i=e.has_paid?"paid":e.payment_status||"free",o={paid:{bg:"rgba(46,204,113,.15)",c:"#2ecc71",b:"#2ecc71"},pending:{bg:"rgba(243,156,18,.15)",c:"#f39c12",b:"#f39c12"},free:{bg:"rgba(220,53,69,.15)",c:"#DC3545",b:"#DC3545"}},r=o[i]||o.free,l=document.createElement("tr");l.dataset.email=(e.email||"").toLowerCase(),l.dataset.name=(e.name||e.full_name||"").toLowerCase(),l.dataset.status=i,l.innerHTML=`\n                <td data-label="Email">${n}</td>\n                <td data-label="Name">${a}</td>\n                <td data-label="Registriert">${new Date(e.created_at).toLocaleDateString("de-CH")}</td>\n                <td data-label="Timer">${s}</td>\n                <td data-label="Status">\n                    <select class="status-select" onchange="adminPanel.updateMemberStatus('${n}',this.value,this)"\n                        style="background:${r.bg};color:${r.c};border:1px solid ${r.b};border-radius:20px;padding:3px 8px;font-size:11px;font-weight:600;cursor:pointer;outline:none;">\n                        <option value="paid" ${"paid"===i?"selected":""}>Paid</option>\n                        <option value="pending" ${"pending"===i?"selected":""}>Pending</option>\n                        <option value="free" ${"free"===i?"selected":""}>Free</option>\n                    </select>\n                </td>\n                <td data-label="Features" style="font-size:12px;">\n                    ${e.pyramid_unlocked?"ðŸ”“":"ðŸ”’"}P ${e.eye_unlocked?"ðŸ”“":"ðŸ”’"}E ${e.chat_ready||e.chat_unlocked?"ðŸ”“":"ðŸ”’"}C\n                    ${e.twofa_enabled?'<span style="color:#2ecc71;" title="2FA aktiv">ðŸ”</span>':""}\n                    ${e.is_blocked?'<span style="color:#e74c3c;"> ðŸš«</span>':""}\n                </td>\n                <td data-label="Aktionen">\n                    <button class="tbl-btn primary" data-action="view" data-email="${this.safeAttr(e.email)}">Details</button>\n                    ${e.is_blocked?`<button class="tbl-btn success" data-action="unblock" data-email="${this.safeAttr(e.email)}">Unblock</button>`:`<button class="tbl-btn" data-action="block" data-email="${this.safeAttr(e.email)}">Block</button>`}\n                    <button class="tbl-btn danger" data-action="delete" data-email="${this.safeAttr(e.email)}">Del</button>\n                </td>\n            `,t.appendChild(l)}),t.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a=t.dataset.email;"view"===n?this.viewUser(a):"block"===n?this.blockUser(a):"unblock"===n?this.unblockUser(a):"delete"===n&&this.deleteUser(a)}))}filterUsersTable(){const e=(document.getElementById("userSearch")?.value||"").toLowerCase(),t=document.getElementById("userStatusFilter")?.value||"all";document.querySelectorAll("#usersTableBody tr").forEach(n=>{const a=n.dataset.email||"",s=n.dataset.name||"",i=n.dataset.status||"",o=!e||a.includes(e)||s.includes(e),r="all"===t||i===t;n.style.display=o&&r?"":"none"})}exportCSV(){if(!this.users.length)return void this.toast("Keine User-Daten vorhanden","warning");const e=[["Email","Name","Registriert","Status","Pyramid","Eye","Chat","Blocked"],...this.users.map(e=>[e.email,e.name||e.full_name||"",new Date(e.created_at).toLocaleDateString("de-CH"),e.has_paid?"Paid":e.payment_status||"Free",e.pyramid_unlocked?"Yes":"No",e.eye_unlocked?"Yes":"No",e.chat_ready||e.chat_unlocked?"Yes":"No",e.is_blocked?"Yes":"No"])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=`billionairs-members-${(new Date).toISOString().slice(0,10)}.csv`,n.click(),URL.revokeObjectURL(n.href)}async viewUser(e){const t=this.users.find(t=>t.email===e);if(!t)return void this.toast("User nicht gefunden","error");this._currentUser=t;const n=document.getElementById("memberModal"),a=document.getElementById("modalTitle"),s=document.getElementById("modalBody");a.textContent=t.email;const i=t.has_paid?"Paid":t.payment_status||"Free",o=t.last_seen?this.formatTimeAgo(new Date(t.last_seen)):"Nie",r=t.paid_at?new Date(t.paid_at).toLocaleDateString("de-CH"):"â€”",l=t.created_at?new Date(t.created_at).toLocaleDateString("de-CH"):"â€”";s.innerHTML=`\n            <div class="detail-row"><span class="detail-label">Email</span><span class="detail-value">${this.escapeHtml(t.email)}</span></div>\n            <div class="detail-row"><span class="detail-label">Name</span><span class="detail-value">${this.escapeHtml(t.name||t.full_name||"â€”")}</span></div>\n            <div class="detail-row"><span class="detail-label">Member ID</span><span class="detail-value">${this.escapeHtml(t.member_id||"â€”")}</span></div>\n            <div class="detail-row"><span class="detail-label">Registriert</span><span class="detail-value">${l}</span></div>\n            <div class="detail-row"><span class="detail-label">Bezahlt am</span><span class="detail-value">${r}</span></div>\n            <div class="detail-row"><span class="detail-label">Status</span><span class="detail-value">${i}</span></div>\n            <div class="detail-row"><span class="detail-label">Letzter Login</span><span class="detail-value">${o}</span></div>\n            <div class="detail-row"><span class="detail-label">Pyramid</span><span class="detail-value">${t.pyramid_unlocked?"ðŸ”“ Unlocked":"ðŸ”’ Locked"}</span></div>\n            <div class="detail-row"><span class="detail-label">Eye</span><span class="detail-value">${t.eye_unlocked?"ðŸ”“ Unlocked":"ðŸ”’ Locked"}</span></div>\n            <div class="detail-row"><span class="detail-label">Chat</span><span class="detail-value">${t.chat_ready||t.chat_unlocked?"ðŸ”“ Unlocked":"ðŸ”’ Locked"}</span></div>\n            <div class="detail-row"><span class="detail-label">2FA</span><span class="detail-value" style="${t.twofa_enabled?"color:#2ecc71":""}">${t.twofa_enabled?"ðŸ” Aktiv":"Deaktiviert"}</span></div>\n            <div class="detail-row"><span class="detail-label">Blockiert</span><span class="detail-value">${t.is_blocked?"ðŸš« Ja":"Nein"}</span></div>\n            <div class="detail-row"><span class="detail-label">Phone</span><span class="detail-value">${this.escapeHtml(t.phone||"â€”")}</span></div>\n            <div class="detail-row"><span class="detail-label">Company</span><span class="detail-value">${this.escapeHtml(t.company||"â€”")}</span></div>\n\n            \x3c!-- NDA Signature Section --\x3e\n            <div class="nda-section" id="ndaSection" style="margin-top:1.5rem;padding:1rem;border:1px solid rgba(201,169,110,0.3);border-radius:8px;background:rgba(201,169,110,0.05);">\n                <h4 style="color:#c9a96e;font-size:.9rem;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem;">\n                    ðŸ“œ NDA-Vereinbarung\n                    <span id="ndaLoadingSpinner" style="font-size:.7rem;color:rgba(255,255,255,0.4);">Laden...</span>\n                </h4>\n                <div id="ndaContent" style="color:rgba(255,255,255,0.6);font-size:.8rem;">â€”</div>\n            </div>\n\n            <div class="notes-section">\n                <h4 style="color:#E8C4A8;font-size:.9rem;margin-bottom:.5rem;">Notizen</h4>\n                <textarea id="memberNotes" placeholder="Interne Notizen...">${this.escapeHtml(t.admin_notes||"")}</textarea>\n                <button class="btn-sm btn-gold" style="margin-top:.5rem;" data-modal-action="save-notes" data-email="${this.safeAttr(t.email)}">Speichern</button>\n            </div>\n\n            <div class="modal-actions">\n                <button class="btn-sm btn-gold" data-modal-action="send-email" data-email="${this.safeAttr(t.email)}">ðŸ“§ Email senden</button>\n                ${t.is_blocked?`<button class="btn-sm btn-green" data-modal-action="unblock" data-email="${this.safeAttr(t.email)}">Unblock</button>`:`<button class="btn-sm btn-red" data-modal-action="block" data-email="${this.safeAttr(t.email)}">Block</button>`}\n                ${t.twofa_enabled?`<button class="btn-sm" style="background:rgba(243,156,18,.2);color:#f39c12;border:1px solid #f39c12;" data-modal-action="reset-2fa" data-email="${this.safeAttr(t.email)}">2FA Reset</button>`:""}\n                <button class="btn-sm btn-red" data-modal-action="delete" data-email="${this.safeAttr(t.email)}">LÃ¶schen</button>\n            </div>\n        `,n.classList.remove("hidden"),this.loadNdaSignature(e),s.addEventListener("click",e=>{const t=e.target.closest("[data-modal-action]");if(!t)return;const n=t.dataset.modalAction,a=t.dataset.email;"save-notes"===n?this.saveNotes(a):"send-email"===n?this.sendEmailToUser(a):"unblock"===n?(this.unblockUser(a),this.closeModal()):"block"===n?(this.blockUser(a),this.closeModal()):"reset-2fa"===n?(this.reset2FA(a),this.closeModal()):"delete"===n&&(this.deleteUser(a),this.closeModal())})}async loadNdaSignature(e){const t=document.getElementById("ndaContent"),n=document.getElementById("ndaLoadingSpinner");if(t)try{const a=this.getSession(),s=await this.authFetch(`/api/admin-nda?email=${encodeURIComponent(e)}`),i=await s.json();if(n&&(n.style.display="none"),!i.success||!i.nda)return void(t.innerHTML='<span style="color:rgba(255,255,255,0.3);">Keine NDA-Unterschrift vorhanden</span>');const o=i.nda;this._currentNda=o;const r=o.agreed_at?new Date(o.agreed_at).toLocaleString("de-CH"):"â€”",l=o.signature_id||"â€”",d=o.document_ref||"â€”",c=o.ip_address||"â€”";t.innerHTML=`\n                <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem .75rem;margin-bottom:1rem;">\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Signatur-ID</span><br><span style="color:#c9a96e;">${this.escapeHtml(l)}</span></div>\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Dokument</span><br>${this.escapeHtml(d)}</div>\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Unterzeichnet am</span><br>${r}</div>\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">IP-Adresse</span><br>${this.escapeHtml(c)}</div>\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Name</span><br>${this.escapeHtml(o.full_name||"â€”")}</div>\n                    <div><span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Firma</span><br>${this.escapeHtml(o.company||"â€”")}</div>\n                </div>\n                <div style="margin-top:.75rem;">\n                    <span style="color:rgba(255,255,255,0.4);font-size:.7rem;">Unterschrift</span>\n                    <div style="background:#1a1a2e;border:1px solid rgba(201,169,110,0.2);border-radius:6px;padding:.75rem;margin-top:.25rem;text-align:center;">\n                        <img src="${o.signature_data}" alt="NDA Unterschrift" style="max-width:100%;max-height:120px;filter:brightness(1.2);" />\n                    </div>\n                </div>\n                <div style="margin-top:.75rem;display:flex;gap:.5rem;justify-content:flex-end;">\n                    <button class="btn-sm btn-gold" onclick="window.open('${o.signature_data}','_blank')" style="font-size:.7rem;padding:.25rem .5rem;">ðŸ” Vollbild</button>\n                    <button class="btn-sm btn-gold" onclick="adminPanel.downloadNdaPdf()" style="font-size:.7rem;padding:.25rem .5rem;">ðŸ“„ PDF herunterladen</button>\n                </div>\n            `}catch(e){n&&(n.style.display="none"),t.innerHTML='<span style="color:#ff6b6b;">Fehler beim Laden der NDA</span>',console.error("NDA load error:",e)}}downloadNdaPdf(){const e=this._currentNda;if(!e)return void this.toast("Keine NDA-Daten vorhanden","error");const t=e.agreed_at?new Date(e.agreed_at).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):"N/A",n=this.escapeHtml(e.full_name||"N/A"),a=this.escapeHtml(e.email||"N/A"),s=this.escapeHtml(e.company||"N/A"),i=this.escapeHtml(e.phone||"N/A"),o=this.escapeHtml(e.signature_id||"N/A"),r=this.escapeHtml(e.document_ref||"BLX-NDA-2026"),l=this.escapeHtml(e.ip_address||"N/A"),d=e.signature_data||"",c={en:"EES - Signed via billionairs.luxury",de:"EES - Signiert Ã¼ber billionairs.luxury",fr:"EES - SignÃ© via billionairs.luxury",es:"EES - Firmado a travÃ©s de billionairs.luxury",it:"EES - Firmato tramite billionairs.luxury",ru:"EES - ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð¾ Ñ‡ÐµÑ€ÐµÐ· billionairs.luxury",zh:"EES - é€šè¿‡ billionairs.luxury ç­¾ç½²",ja:"EES - billionairs.luxury ã‚’é€šã˜ã¦ç½²å",ar:"EES - Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± billionairs.luxury"},m=`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>BILLIONAIRS NDA &mdash; ${n}</title>\n<style>\n@page { size: A4; margin: 2.5cm 2.5cm 3cm 2.5cm; }\n* { margin: 0; padding: 0; box-sizing: border-box; }\nbody { font-family: 'Georgia', 'Times New Roman', serif; font-size: 11pt; line-height: 1.6; color: #1a1a1a; background: #fff; max-width: 210mm; margin: 0 auto; padding: 2.5cm; }\n.header { text-align: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid #c9a96e; }\n.header h1 { font-size: 22pt; font-weight: 700; letter-spacing: 4px; color: #1a1a1a; margin-bottom: .3rem; }\n.header h2 { font-size: 13pt; font-weight: 400; color: #666; letter-spacing: 2px; text-transform: uppercase; }\n.header .doc-ref { font-size: 9pt; color: #999; margin-top: .5rem; }\n.gold-line { width: 60px; height: 2px; background: #c9a96e; margin: 1.5rem auto; }\nh3 { font-size: 12pt; font-weight: 700; margin-top: 1.5rem; margin-bottom: .5rem; color: #1a1a1a; }\nh3 .sn { color: #c9a96e; margin-right: .5rem; }\np { margin-bottom: .8rem; text-align: justify; }\n.parties { background: #fafaf8; border: 1px solid #e8e4dc; border-radius: 4px; padding: 1.2rem 1.5rem; margin: 1.5rem 0; }\n.parties p { margin-bottom: .4rem; }\n.parties strong { color: #c9a96e; }\nol { padding-left: 1.5rem; margin-bottom: .8rem; }\nol li { margin-bottom: .4rem; text-align: justify; }\n.confidential-stamp { text-align: center; margin: 1rem 0; font-size: 9pt; font-weight: 700; letter-spacing: 3px; color: #c9a96e; text-transform: uppercase; }\n.sig-section { margin-top: 3rem; page-break-inside: avoid; }\n.sig-block { display: flex; justify-content: space-between; gap: 3rem; margin-top: 2rem; }\n.sig-party { flex: 1; }\n.sig-party h4 { font-size: 10pt; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: #c9a96e; margin-bottom: 1rem; }\n.sig-line { border-bottom: 1px solid #1a1a1a; height: 40px; margin-bottom: .3rem; }\n.sig-label { font-size: 9pt; color: #888; margin-bottom: 1rem; }\n.ees-badge { margin-top: .5rem; padding: .6rem 1rem; border: 1px solid #e0ddd6; border-radius: 6px; background: #fafaf8; display: flex; align-items: center; gap: .75rem; }\n.ees-badge img { width: 40px; height: auto; }\n.ees-badge .ees-info { font-size: 8.5pt; color: #555; line-height: 1.4; }\n.ees-badge .ees-info strong { color: #1a1a1a; font-size: 9.5pt; display: block; margin-bottom: 2px; }\n.ees-badge .ees-info .ees-note { color: #c9a96e; font-size: 7.5pt; margin-top: 2px; }\n.sig-img { max-width: 200px; max-height: 80px; }\n.member-sig-line { border-bottom: 1px solid #1a1a1a; min-height: 60px; margin-bottom: .3rem; display: flex; align-items: flex-end; padding-bottom: 4px; }\n.footer { margin-top: 3rem; padding-top: 1rem; border-top: 1px solid #e8e4dc; text-align: center; font-size: 8.5pt; color: #aaa; }\n.meta-box { background: #f8f7f5; border: 1px solid #e0ddd6; border-radius: 4px; padding: .8rem 1rem; margin: 1rem 0; font-size: 9pt; color: #666; }\n.meta-box strong { color: #1a1a1a; }\n@media print { body { padding: 0; } .no-print { display: none !important; } }\n.print-bar { position: fixed; top: 0; left: 0; right: 0; background: #1a1a1a; padding: 12px 24px; display: flex; align-items: center; justify-content: center; gap: 16px; z-index: 9999; }\n.print-bar button { background: #c9a96e; color: #1a1a1a; border: none; padding: 10px 28px; font-size: 12pt; font-family: Georgia, serif; cursor: pointer; letter-spacing: 1px; font-weight: 700; border-radius: 4px; }\n.print-bar button:hover { background: #b8944f; }\n.print-bar span { color: #c9a96e; font-family: Georgia, serif; font-size: 11pt; }\n</style>\n</head>\n<body>\n\n<div class="print-bar no-print">\n    <span>BILLIONAIRS NDA</span>\n    <button onclick="window.print()">&#x2B07; Als PDF speichern / Drucken</button>\n</div>\n\n<div style="margin-top: 60px;"></div>\n\n<div class="header">\n    <h1>BILLIONAIRS</h1>\n    <h2>Mutual Non-Disclosure &amp; Membership Agreement</h2>\n    <div class="gold-line"></div>\n    <div class="doc-ref">Document Ref: ${r} &nbsp;|&nbsp; Signature ID: ${o} &nbsp;|&nbsp; Confidential</div>\n</div>\n\n<div class="confidential-stamp">&mdash; Strictly Confidential &mdash;</div>\n\n<div class="meta-box">\n    <strong>Signed by:</strong> ${n} &nbsp;|&nbsp;\n    <strong>Email:</strong> ${a} &nbsp;|&nbsp;\n    <strong>Company:</strong> ${s} &nbsp;|&nbsp;\n    <strong>Date:</strong> ${t} &nbsp;|&nbsp;\n    <strong>IP:</strong> ${l}\n</div>\n\n<p>This Mutual Non-Disclosure &amp; Membership Agreement (hereinafter referred to as the <strong>&ldquo;Agreement&rdquo;</strong>) is entered into as of <strong>${t}</strong> (the <strong>&ldquo;Effective Date&rdquo;</strong>) by and between:</p>\n\n<div class="parties">\n    <p><strong>Party A (the Company):</strong><br>\n    BILLIONAIRS, operating under the domain billionairs.luxury, registered in Switzerland<br>\n    (hereinafter referred to as <strong>&ldquo;BILLIONAIRS&rdquo;</strong> or <strong>&ldquo;the Company&rdquo;</strong>)</p>\n    <br>\n    <p><strong>Party B (the Member):</strong><br>\n    ${n}${"N/A"!==s?", "+s:""}<br>\n    (hereinafter referred to as <strong>&ldquo;the Member&rdquo;</strong>)</p>\n</div>\n\n<p>BILLIONAIRS and the Member are collectively referred to as the <strong>&ldquo;Parties&rdquo;</strong> and individually as a <strong>&ldquo;Party.&rdquo;</strong></p>\n\n<div class="gold-line"></div>\n\n<h3><span class="sn">1.</span> Purpose &amp; Scope</h3>\n<p>The purpose of this Agreement is to establish the mutual obligations, rights, and responsibilities of both Parties in connection with the Member&rsquo;s access to the exclusive BILLIONAIRS private membership platform, and to protect the confidential information exchanged between the Parties.</p>\n\n<h3><span class="sn">2.</span> Service Description</h3>\n<p>BILLIONAIRS provides the following services to accepted Members (the <strong>&ldquo;Services&rdquo;</strong>):</p>\n<ol type="a">\n    <li><strong>Exclusive Membership Platform:</strong> Access to a private, curated digital platform designed for high-net-worth individuals;</li>\n    <li><strong>Private Networking:</strong> Access to a verified member network for direct, encrypted communication between Members;</li>\n    <li><strong>Encrypted Communications:</strong> End-to-end encrypted chat functionality (AES-256-GCM) for private Member-to-Member and CEO communication;</li>\n    <li><strong>Curated Content:</strong> Access to exclusive content, insights, and information shared within the platform;</li>\n    <li><strong>Digital Membership Certificate:</strong> A personalized, downloadable membership certificate;</li>\n    <li><strong>Ongoing Platform Maintenance:</strong> BILLIONAIRS commits to maintaining platform availability with commercially reasonable efforts, targeting 99.5% monthly uptime (excluding scheduled maintenance);</li>\n    <li><strong>Security &amp; Privacy:</strong> Industry-standard security measures to protect Member data and communications.</li>\n</ol>\n<p>BILLIONAIRS reserves the right to enhance, modify, or add features to the platform. Material changes that significantly reduce core Services will be communicated to Members with at least 30 days&rsquo; advance notice.</p>\n\n<h3><span class="sn">3.</span> Definition of Confidential Information</h3>\n<p><strong>&ldquo;Confidential Information&rdquo;</strong> means any and all non-public information disclosed by either Party to the other Party, whether orally, in writing, electronically, or by any other means, including but not limited to:</p>\n<ol type="a">\n    <li>The identity, personal data, and contact details of BILLIONAIRS members;</li>\n    <li>Any communications, discussions, or exchanges within the BILLIONAIRS platform, including private chats and group discussions;</li>\n    <li>Business strategies, investment opportunities, financial data, and deal flow shared within the platform;</li>\n    <li>Proprietary technology, software, algorithms, and platform architecture;</li>\n    <li>Marketing strategies, pricing models, and membership structures;</li>\n    <li>Any information explicitly marked as &ldquo;Confidential&rdquo; or &ldquo;Proprietary&rdquo;;</li>\n    <li>Personal and financial information provided by the Member to BILLIONAIRS during registration and membership.</li>\n</ol>\n<p>The classification of information as confidential shall be based on objective criteria and the nature of the information, not solely on one Party&rsquo;s subjective designation.</p>\n\n<h3><span class="sn">4.</span> Mutual Confidentiality Obligations</h3>\n<p><strong>4.1 Obligations of the Member:</strong></p>\n<ol type="a">\n    <li><strong>Maintain Confidentiality:</strong> Keep all Confidential Information strictly confidential and not disclose it to any third party without the prior written consent of BILLIONAIRS;</li>\n    <li><strong>Restrict Use:</strong> Use the Confidential Information solely in connection with the membership;</li>\n    <li><strong>Exercise Care:</strong> Apply at least the same degree of care to protect the Confidential Information as the Member uses to protect their own confidential information, but in no event less than reasonable care;</li>\n    <li><strong>No Unauthorized Reproduction:</strong> Not copy, reproduce, screenshot, record, or otherwise duplicate any Confidential Information unless expressly authorized by BILLIONAIRS;</li>\n    <li><strong>Discretion:</strong> Not discuss, publish, post, or otherwise share any information about BILLIONAIRS members, conversations, or activities on social media, press, blogs, forums, or any other public platform without prior written consent;</li>\n    <li><strong>Return or Destroy:</strong> Upon termination of membership or upon request, promptly return or destroy all materials containing Confidential Information.</li>\n</ol>\n<p><strong>4.2 Obligations of BILLIONAIRS:</strong></p>\n<ol type="a">\n    <li><strong>Protect Member Data:</strong> BILLIONAIRS shall safeguard all personal, financial, and communication data provided by the Member using industry-standard security measures (including encryption at rest and in transit);</li>\n    <li><strong>No Unauthorized Sharing:</strong> BILLIONAIRS shall not disclose, sell, rent, or share Member data with third parties for commercial purposes without the Member&rsquo;s explicit written consent;</li>\n    <li><strong>Restricted Internal Access:</strong> Access to Member information within BILLIONAIRS shall be limited to authorized personnel on a need-to-know basis;</li>\n    <li><strong>Breach Notification:</strong> In the event of a data breach affecting Member information, BILLIONAIRS shall notify the affected Member within 72 hours of becoming aware of the breach;</li>\n    <li><strong>Compliance:</strong> BILLIONAIRS shall handle all personal data in compliance with applicable data protection laws (see Section 10).</li>\n</ol>\n\n<h3><span class="sn">5.</span> Exclusions from Confidential Information</h3>\n<p>Confidential Information does not include information that:</p>\n<ol type="a">\n    <li>Was already in the public domain at the time of disclosure;</li>\n    <li>Becomes publicly available through no breach of this Agreement;</li>\n    <li>Was already known to the receiving Party prior to disclosure, as evidenced by written records;</li>\n    <li>Is independently developed by the receiving Party without reference to the Confidential Information;</li>\n    <li>Is required to be disclosed by law, regulation, or court order, provided the disclosing Party is given prompt written notice and reasonable opportunity to seek protective measures.</li>\n</ol>\n\n<h3><span class="sn">6.</span> Duration of Confidentiality</h3>\n<p>The confidentiality obligations under this Agreement shall remain in effect for the duration of the Member&rsquo;s membership and for a period of <strong>three (3) years</strong> following the termination or expiration of such membership, unless a longer period is required by applicable law.</p>\n\n<h3><span class="sn">7.</span> Remedies for Breach</h3>\n<p><strong>7.1</strong> Both Parties acknowledge that any breach of the confidentiality obligations may cause irreparable harm. Accordingly, the non-breaching Party shall be entitled to seek injunctive relief, specific performance, and any other equitable remedies available under Swiss law, in addition to damages.</p>\n<p><strong>7.2</strong> Prior to initiating legal proceedings, the Parties agree to attempt to resolve disputes through good-faith negotiation for a period of 30 days (see Section 14).</p>\n\n<h3><span class="sn">8.</span> Membership Fee &amp; Refund Policy</h3>\n<p>The Member acknowledges and agrees that:</p>\n<ol type="a">\n    <li>The one-time membership fee of <strong>CHF 500,000</strong> is generally <strong>non-refundable</strong> once access to the platform has been granted, as the Service is deemed rendered upon provision of access credentials;</li>\n    <li>The membership fee constitutes payment for <strong>exclusive access</strong> to the BILLIONAIRS platform and the Services described in Section 2;</li>\n    <li>The Member agrees not to initiate chargebacks or payment disputes without first following the dispute resolution process outlined in Section 14. Any chargeback initiated without prior good-faith resolution attempt shall constitute a material breach of this Agreement;</li>\n    <li>In the event of a confirmed NDA breach by the Member, BILLIONAIRS reserves the right to terminate the membership without refund.</li>\n</ol>\n<p><strong>8.2 Exceptions &mdash; Refund Entitlement:</strong></p>\n<p>Notwithstanding Section 8(a), the Member shall be entitled to a full or partial refund in the following circumstances:</p>\n<ol type="a">\n    <li><strong>Material Non-Performance:</strong> If BILLIONAIRS fails to provide the core Services described in Section 2 for a continuous period exceeding 30 days (excluding force majeure events), the Member may request a pro-rata refund;</li>\n    <li><strong>Fraudulent Misrepresentation:</strong> If it is established that BILLIONAIRS made materially false statements to induce the Member&rsquo;s payment, the Member is entitled to a full refund under Swiss law (Art. 28 OR);</li>\n    <li><strong>Cooling-Off Period:</strong> The Member may cancel within <strong>14 days</strong> of payment if platform access has not yet been used, in accordance with applicable consumer protection principles;</li>\n    <li><strong>Statutory Rights:</strong> Nothing in this Agreement shall exclude or limit any refund rights that cannot be waived under mandatory Swiss law (including Art. 8 UWG).</li>\n</ol>\n<p>By signing this Agreement, the Member confirms understanding and voluntary acceptance of this fee structure <strong>prior to making payment</strong>.</p>\n\n<h3><span class="sn">9.</span> Company Liability &amp; Obligations</h3>\n<p><strong>9.1</strong> BILLIONAIRS undertakes to provide the Services with commercially reasonable skill and care.</p>\n<p><strong>9.2</strong> BILLIONAIRS shall be liable for:</p>\n<ol type="a">\n    <li>Damages caused by intentional misconduct or gross negligence of BILLIONAIRS or its agents;</li>\n    <li>Breach of its confidentiality obligations under Section 4.2;</li>\n    <li>Breach of applicable data protection laws;</li>\n    <li>Any bodily injury or death caused by BILLIONAIRS&rsquo;s negligence.</li>\n</ol>\n<p><strong>9.3</strong> BILLIONAIRS shall not be liable for:</p>\n<ol type="a">\n    <li>Investment decisions made based on information or discussions within the platform &mdash; all investment decisions remain the sole responsibility of the Member;</li>\n    <li>Actions, statements, or conduct of other Members on the platform;</li>\n    <li>Temporary platform unavailability due to maintenance, updates, or circumstances beyond BILLIONAIRS&rsquo;s reasonable control (force majeure);</li>\n    <li>Indirect, consequential, or speculative damages, except where exclusion is prohibited by mandatory Swiss law.</li>\n</ol>\n<p><strong>9.4</strong> The total aggregate liability of BILLIONAIRS under this Agreement (excluding cases of intentional misconduct) shall not exceed the membership fee paid by the Member (CHF 500,000).</p>\n\n<h3><span class="sn">10.</span> Data Protection &amp; Privacy</h3>\n<p><strong>10.1</strong> BILLIONAIRS processes personal data in accordance with the Swiss Federal Act on Data Protection (<strong>nDSG</strong>, effective 1 September 2023) and, where applicable, the EU General Data Protection Regulation (<strong>GDPR</strong>).</p>\n<p><strong>10.2</strong> The Member has the following data rights:</p>\n<ol type="a">\n    <li><strong>Right of Access:</strong> The Member may request information about what personal data is stored;</li>\n    <li><strong>Right to Rectification:</strong> The Member may request correction of inaccurate data;</li>\n    <li><strong>Right to Deletion:</strong> The Member may request deletion of personal data, subject to legal retention obligations;</li>\n    <li><strong>Right to Data Portability:</strong> The Member may request their data in a structured, machine-readable format;</li>\n    <li><strong>Right to Object:</strong> The Member may object to specific data processing activities.</li>\n</ol>\n<p><strong>10.3</strong> Data protection requests can be submitted to: <strong>privacy@billionairs.luxury</strong></p>\n<p><strong>10.4</strong> BILLIONAIRS shall not transfer Member data to countries without adequate data protection standards unless appropriate safeguards are in place (e.g., Standard Contractual Clauses).</p>\n\n<h3><span class="sn">11.</span> Membership Termination</h3>\n<p><strong>11.1 Termination by the Member:</strong></p>\n<ol type="a">\n    <li>The Member may terminate their membership at any time by providing written notice to BILLIONAIRS;</li>\n    <li>Termination does not entitle the Member to a refund except as specified in Section 8.2;</li>\n    <li>Upon termination, the Member&rsquo;s access to the platform will be revoked within 7 business days;</li>\n    <li>The Member may request export of their personal data prior to termination.</li>\n</ol>\n<p><strong>11.2 Termination by BILLIONAIRS:</strong></p>\n<ol type="a">\n    <li>BILLIONAIRS may terminate membership for material breach of this Agreement, including NDA violations, after providing written notice and a 14-day cure period (except in cases of severe breach where immediate termination is justified);</li>\n    <li>BILLIONAIRS may terminate membership if the Member engages in illegal activities on the platform;</li>\n    <li>In the event BILLIONAIRS permanently ceases operations, Members shall receive a pro-rata refund for any remaining membership term, if applicable.</li>\n</ol>\n\n<h3><span class="sn">12.</span> No License</h3>\n<p>Nothing in this Agreement grants either Party any license or right in any intellectual property or proprietary rights of the other Party.</p>\n\n<h3><span class="sn">13.</span> Governing Law &amp; Jurisdiction</h3>\n<p>This Agreement shall be governed by the substantive laws of <strong>Switzerland</strong> (excluding conflict-of-law provisions). Any disputes shall be subject to the exclusive jurisdiction of the courts of <strong>Zurich, Switzerland</strong>.</p>\n\n<h3><span class="sn">14.</span> Dispute Resolution</h3>\n<p><strong>14.1</strong> Before initiating any legal proceedings, both Parties agree to attempt to resolve disputes through good-faith negotiation within <strong>30 days</strong> of written notice of the dispute.</p>\n<p><strong>14.2</strong> If negotiation fails, either Party may submit the dispute to <strong>mediation</strong> under the Swiss Rules of Commercial Mediation administered by the Swiss Chambers&rsquo; Arbitration Institution. Mediation costs shall be shared equally.</p>\n<p><strong>14.3</strong> If mediation fails within 60 days, either Party may pursue litigation before the courts of Zurich, Switzerland, or initiate arbitration under the Swiss Rules of International Arbitration, at the claimant&rsquo;s election.</p>\n\n<h3><span class="sn">15.</span> Severability</h3>\n<p>If any provision of this Agreement is found to be invalid, unenforceable, or contrary to mandatory law, the remaining provisions shall continue in full force and effect. The invalid provision shall be replaced by a valid provision that most closely reflects the Parties&rsquo; original intent.</p>\n\n<h3><span class="sn">16.</span> Entire Agreement</h3>\n<p>This Agreement constitutes the entire agreement between the Parties with respect to its subject matter and supersedes all prior negotiations, representations, and agreements. Amendments to this Agreement must be made in writing and signed by both Parties.</p>\n\n<h3><span class="sn">17.</span> Electronic Signature</h3>\n<p>The Parties agree that this Agreement may be executed electronically. Electronic signatures shall have the same legal effect as handwritten signatures in accordance with the Swiss Federal Act on Electronic Signatures (ZertES) and the EU eIDAS Regulation.</p>\n\n<div class="gold-line"></div>\n\n<div class="sig-section">\n    <p><strong>IN WITNESS WHEREOF,</strong> the Parties have executed this Non-Disclosure Agreement as of the Effective Date.</p>\n    <div class="sig-block">\n        <div class="sig-party">\n            <h4>The Company</h4>\n            <div class="ees-badge">\n                <img src="https://billionairs.luxury/assets/images/logo.png" alt="BILLIONAIRS Logo">\n                <div class="ees-info">\n                    <strong>billionairs.luxury</strong>\n                    ${e.agreed_at?new Date(e.agreed_at).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"}<br>\n                    <span class="ees-note">${c[this._currentUser&&this._currentUser.preferred_language||"en"]||c.en}</span>\n                </div>\n            </div>\n            <div class="sig-label" style="margin-top:.5rem;">BILLIONAIRS &mdash; Authorized Representative</div>\n        </div>\n        <div class="sig-party">\n            <h4>The Member</h4>\n            <div class="member-sig-line">\n                ${d?'<img class="sig-img" src="'+d+'" alt="Signature" />':""}\n            </div>\n            <div class="sig-label">Signature</div>\n            <p style="font-size:10pt;"><strong>${n}</strong>${"N/A"!==s?"<br>"+s:""}</p>\n            <div class="sig-label">Date: ${t}</div>\n        </div>\n    </div>\n</div>\n\n<div class="meta-box" style="margin-top:2rem;">\n    <strong>Verification Details:</strong><br>\n    Signature ID: ${o} &nbsp;|&nbsp;\n    Document Ref: ${r} &nbsp;|&nbsp;\n    IP Address: ${l} &nbsp;|&nbsp;\n    Email: ${a} &nbsp;|&nbsp;\n    Phone: ${i}\n</div>\n\n<div class="footer">\n    <p>BILLIONAIRS &nbsp;|&nbsp; billionairs.luxury &nbsp;|&nbsp; Confidential Document</p>\n    <p>This document is subject to copyright protection. Unauthorized reproduction is prohibited.</p>\n    <p style="margin-top:.5rem;font-size:8pt;">Electronically signed &mdash; ${t}</p>\n</div>\n\n<script>\n// Auto-trigger print dialog after short delay\nsetTimeout(function() { window.print(); }, 800);\n<\/script>\n</body>\n</html>`,u=window.open("","_blank");u?(u.document.write(m),u.document.close()):this.toast("Popup-Blocker aktiv. Bitte erlauben Sie Popups.","error")}closeModal(){document.getElementById("memberModal").classList.add("hidden")}async saveNotes(e){const t=document.getElementById("memberNotes")?.value||"";try{const n=this.getSession();(await this.authFetch("/api/admin-member-notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,notes:t})})).ok?this.toast("Notizen gespeichert","success"):this.toast("Fehler beim Speichern","error")}catch(e){console.error("Save notes error:",e),this.toast("Fehler","error")}}sendEmailToUser(e){const t=document.getElementById("emailComposerModal"),n=document.getElementById("emailTo"),a=document.getElementById("emailSubject"),s=document.getElementById("emailBody"),i=document.getElementById("emailTemplate"),o=document.getElementById("emailCharCount"),r=document.getElementById("emailSendBtn"),l=this.users.find(t=>t.email===e),d=l?.preferred_language||"en",c=l?.name||l?.full_name||"Member",m={en:"English",de:"Deutsch",fr:"FranÃ§ais",es:"EspaÃ±ol",it:"Italiano",ru:"Ð ÑƒÑÑÐºÐ¸Ð¹",zh:"ä¸­æ–‡",ja:"æ—¥æœ¬èªž",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"},u=document.getElementById("emailLangHint");u&&(u.textContent=`ðŸŒ ${m[d]||d}`,u.title=`Email wird in ${m[d]||d} gesendet`);const p={en:{welcome:{subject:"Welcome to BILLIONAIRS",body:`Dear ${c},\n\nWe warmly welcome you to BILLIONAIRS.\n\nYour exclusive access has been activated and is now available to you. As a member of our private network, you benefit from unique privileges and connections.\n\nShould you have any questions, we are at your disposal at any time.\n\nBest regards,\nBILLIONAIRS Management`},"payment-reminder":{subject:"Payment Reminder â€” BILLIONAIRS Membership",body:`Dear ${c},\n\nWe would like to kindly remind you that your membership fee is still outstanding.\n\nPlease complete your payment through your dashboard to continue enjoying full access to all exclusive features.\n\nFor questions, contact us at support@billionairs.luxury.\n\nBest regards,\nBILLIONAIRS Management`},"account-issue":{subject:"Important Information About Your Account â€” BILLIONAIRS",body:`Dear ${c},\n\nWe would like to inform you about a matter concerning your BILLIONAIRS account.\n\n[Please describe the issue here]\n\nPlease contact us promptly so we can resolve this matter.\n\nBest regards,\nBILLIONAIRS Management`},"membership-update":{subject:"Update to Your BILLIONAIRS Membership",body:`Dear ${c},\n\nWe would like to inform you about an update to your membership.\n\n[Update details]\n\nThese changes take effect immediately.\n\nBest regards,\nBILLIONAIRS Management`}},de:{welcome:{subject:"Willkommen bei BILLIONAIRS",body:`Sehr geehrte/r ${c},\n\nWir heissen Sie herzlich willkommen bei BILLIONAIRS.\n\nIhr exklusiver Zugang wurde aktiviert und steht Ihnen ab sofort zur VerfÃ¼gung. Als Mitglied unseres privaten Netzwerks profitieren Sie von einzigartigen Privilegien und Verbindungen.\n\nSollten Sie Fragen haben, stehen wir Ihnen jederzeit zur VerfÃ¼gung.\n\nMit besten GrÃ¼ssen,\nBILLIONAIRS Management`},"payment-reminder":{subject:"Zahlungserinnerung â€” BILLIONAIRS Mitgliedschaft",body:`Sehr geehrte/r ${c},\n\nWir mÃ¶chten Sie hÃ¶flich daran erinnern, dass Ihre MitgliedschaftsgebÃ¼hr noch aussteht.\n\nBitte vervollstÃ¤ndigen Sie die Zahlung Ã¼ber Ihr Dashboard, um weiterhin vollen Zugang zu allen exklusiven Funktionen zu geniessen.\n\nBei Fragen kontaktieren Sie uns unter support@billionairs.luxury.\n\nMit besten GrÃ¼ssen,\nBILLIONAIRS Management`},"account-issue":{subject:"Wichtige Information zu Ihrem Account â€” BILLIONAIRS",body:`Sehr geehrte/r ${c},\n\nWir mÃ¶chten Sie Ã¼ber ein Anliegen bezÃ¼glich Ihres BILLIONAIRS-Accounts informieren.\n\n[Bitte beschreiben Sie hier das Problem]\n\nBitte kontaktieren Sie uns zeitnah, damit wir die Angelegenheit klÃ¤ren kÃ¶nnen.\n\nMit besten GrÃ¼ssen,\nBILLIONAIRS Management`},"membership-update":{subject:"Update Ihrer BILLIONAIRS Mitgliedschaft",body:`Sehr geehrte/r ${c},\n\nWir mÃ¶chten Sie Ã¼ber eine Aktualisierung Ihrer Mitgliedschaft informieren.\n\n[Details zum Update]\n\nDiese Ã„nderungen treten ab sofort in Kraft.\n\nMit besten GrÃ¼ssen,\nBILLIONAIRS Management`}},fr:{welcome:{subject:"Bienvenue chez BILLIONAIRS",body:`Cher/ChÃ¨re ${c},\n\nNous vous souhaitons chaleureusement la bienvenue chez BILLIONAIRS.\n\nVotre accÃ¨s exclusif a Ã©tÃ© activÃ© et est dÃ©sormais disponible. En tant que membre de notre rÃ©seau privÃ©, vous bÃ©nÃ©ficiez de privilÃ¨ges et de connexions uniques.\n\nSi vous avez des questions, nous sommes Ã  votre disposition Ã  tout moment.\n\nCordialement,\nBILLIONAIRS Management`},"payment-reminder":{subject:"Rappel de paiement â€” AdhÃ©sion BILLIONAIRS",body:`Cher/ChÃ¨re ${c},\n\nNous vous rappelons aimablement que votre cotisation d'adhÃ©sion est encore en attente.\n\nVeuillez complÃ©ter le paiement via votre tableau de bord pour continuer Ã  profiter de l'accÃ¨s complet Ã  toutes les fonctionnalitÃ©s exclusives.\n\nPour toute question, contactez-nous Ã  support@billionairs.luxury.\n\nCordialement,\nBILLIONAIRS Management`},"account-issue":{subject:"Information importante concernant votre compte â€” BILLIONAIRS",body:`Cher/ChÃ¨re ${c},\n\nNous souhaitons vous informer d'un sujet concernant votre compte BILLIONAIRS.\n\n[Veuillez dÃ©crire le problÃ¨me ici]\n\nVeuillez nous contacter rapidement afin que nous puissions rÃ©soudre cette affaire.\n\nCordialement,\nBILLIONAIRS Management`},"membership-update":{subject:"Mise Ã  jour de votre adhÃ©sion BILLIONAIRS",body:`Cher/ChÃ¨re ${c},\n\nNous souhaitons vous informer d'une mise Ã  jour de votre adhÃ©sion.\n\n[DÃ©tails de la mise Ã  jour]\n\nCes modifications prennent effet immÃ©diatement.\n\nCordialement,\nBILLIONAIRS Management`}},es:{welcome:{subject:"Bienvenido/a a BILLIONAIRS",body:`Estimado/a ${c},\n\nLe damos una cÃ¡lida bienvenida a BILLIONAIRS.\n\nSu acceso exclusivo ha sido activado y ya estÃ¡ disponible. Como miembro de nuestra red privada, usted se beneficia de privilegios y conexiones Ãºnicos.\n\nSi tiene alguna pregunta, estamos a su disposiciÃ³n en todo momento.\n\nAtentamente,\nBILLIONAIRS Management`},"payment-reminder":{subject:"Recordatorio de pago â€” MembresÃ­a BILLIONAIRS",body:`Estimado/a ${c},\n\nLe recordamos amablemente que su cuota de membresÃ­a aÃºn estÃ¡ pendiente.\n\nPor favor, complete el pago a travÃ©s de su panel de control para seguir disfrutando del acceso completo a todas las funciones exclusivas.\n\nPara preguntas, contÃ¡ctenos en support@billionairs.luxury.\n\nAtentamente,\nBILLIONAIRS Management`},"account-issue":{subject:"InformaciÃ³n importante sobre su cuenta â€” BILLIONAIRS",body:`Estimado/a ${c},\n\nDeseamos informarle sobre un asunto relacionado con su cuenta BILLIONAIRS.\n\n[Por favor, describa el problema aquÃ­]\n\nPor favor, pÃ³ngase en contacto con nosotros lo antes posible para resolver este asunto.\n\nAtentamente,\nBILLIONAIRS Management`},"membership-update":{subject:"ActualizaciÃ³n de su membresÃ­a BILLIONAIRS",body:`Estimado/a ${c},\n\nDeseamos informarle sobre una actualizaciÃ³n de su membresÃ­a.\n\n[Detalles de la actualizaciÃ³n]\n\nEstos cambios entran en vigor de inmediato.\n\nAtentamente,\nBILLIONAIRS Management`}},it:{welcome:{subject:"Benvenuto/a in BILLIONAIRS",body:`Gentile ${c},\n\nLe diamo il benvenuto in BILLIONAIRS.\n\nIl Suo accesso esclusivo Ã¨ stato attivato ed Ã¨ ora disponibile. Come membro della nostra rete privata, Lei beneficia di privilegi e connessioni unici.\n\nPer qualsiasi domanda, siamo a Sua disposizione in qualsiasi momento.\n\nCordiali saluti,\nBILLIONAIRS Management`},"payment-reminder":{subject:"Promemoria di pagamento â€” Abbonamento BILLIONAIRS",body:`Gentile ${c},\n\nDesideriamo ricordarLe gentilmente che la quota di abbonamento Ã¨ ancora in sospeso.\n\nLa preghiamo di completare il pagamento tramite la Sua dashboard per continuare a godere dell'accesso completo a tutte le funzionalitÃ  esclusive.\n\nPer domande, ci contatti a support@billionairs.luxury.\n\nCordiali saluti,\nBILLIONAIRS Management`},"account-issue":{subject:"Informazione importante sul Suo account â€” BILLIONAIRS",body:`Gentile ${c},\n\nDesideriamo informarLa riguardo una questione relativa al Suo account BILLIONAIRS.\n\n[Descrivere il problema qui]\n\nLa preghiamo di contattarci tempestivamente per risolvere la questione.\n\nCordiali saluti,\nBILLIONAIRS Management`},"membership-update":{subject:"Aggiornamento del Suo abbonamento BILLIONAIRS",body:`Gentile ${c},\n\nDesideriamo informarLa di un aggiornamento del Suo abbonamento.\n\n[Dettagli dell'aggiornamento]\n\nQueste modifiche hanno effetto immediato.\n\nCordiali saluti,\nBILLIONAIRS Management`}},ru:{welcome:{subject:"Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² BILLIONAIRS",body:`Ð£Ð²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ð¹/Ð°Ñ ${c},\n\nÐœÑ‹ ÑÐµÑ€Ð´ÐµÑ‡Ð½Ð¾ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÐ¼ Ð’Ð°Ñ Ð² BILLIONAIRS.\n\nÐ’Ð°Ñˆ ÑÐºÑÐºÐ»ÑŽÐ·Ð¸Ð²Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ. ÐšÐ°Ðº ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸Ðº Ð½Ð°ÑˆÐµÐ¹ Ñ‡Ð°ÑÑ‚Ð½Ð¾Ð¹ ÑÐµÑ‚Ð¸, Ð’Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÐµÑÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ñ€Ð¸Ð²Ð¸Ð»ÐµÐ³Ð¸ÑÐ¼Ð¸ Ð¸ ÑÐ²ÑÐ·ÑÐ¼Ð¸.\n\nÐ•ÑÐ»Ð¸ Ñƒ Ð’Ð°Ñ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, Ð¼Ñ‹ Ðº Ð’Ð°ÑˆÐ¸Ð¼ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼ Ð² Ð»ÑŽÐ±Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ.\n\nÐ¡ Ð½Ð°Ð¸Ð»ÑƒÑ‡ÑˆÐ¸Ð¼Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸ÑÐ¼Ð¸,\nBILLIONAIRS Management`},"payment-reminder":{subject:"ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ðµ â€” Ð§Ð»ÐµÐ½ÑÑ‚Ð²Ð¾ BILLIONAIRS",body:`Ð£Ð²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ð¹/Ð°Ñ ${c},\n\nÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÐ¼ Ð’Ð°Ð¼, Ñ‡Ñ‚Ð¾ Ð’Ð°Ñˆ Ñ‡Ð»ÐµÐ½ÑÐºÐ¸Ð¹ Ð²Ð·Ð½Ð¾Ñ ÐµÑ‰Ñ‘ Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½.\n\nÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ðµ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ñ‡ÐµÑ€ÐµÐ· Ð’Ð°ÑˆÑƒ Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¿Ð¾Ð»Ð½Ñ‹Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼ ÐºÐ¾ Ð²ÑÐµÐ¼ ÑÐºÑÐºÐ»ÑŽÐ·Ð¸Ð²Ð½Ñ‹Ð¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼.\n\nÐŸÐ¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ support@billionairs.luxury.\n\nÐ¡ Ð½Ð°Ð¸Ð»ÑƒÑ‡ÑˆÐ¸Ð¼Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸ÑÐ¼Ð¸,\nBILLIONAIRS Management`},"account-issue":{subject:"Ð’Ð°Ð¶Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð’Ð°ÑˆÐµÐ¼ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ðµ â€” BILLIONAIRS",body:`Ð£Ð²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ð¹/Ð°Ñ ${c},\n\nÐœÑ‹ Ñ…Ð¾Ñ‚Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Ð’Ð°Ð¼ Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐµ, ÐºÐ°ÑÐ°ÑŽÑ‰ÐµÐ¼ÑÑ Ð’Ð°ÑˆÐµÐ³Ð¾ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð° BILLIONAIRS.\n\n[ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹]\n\nÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð½Ð°Ð¼Ð¸ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°.\n\nÐ¡ Ð½Ð°Ð¸Ð»ÑƒÑ‡ÑˆÐ¸Ð¼Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸ÑÐ¼Ð¸,\nBILLIONAIRS Management`},"membership-update":{subject:"ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð’Ð°ÑˆÐµÐ³Ð¾ Ñ‡Ð»ÐµÐ½ÑÑ‚Ð²Ð° BILLIONAIRS",body:`Ð£Ð²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ð¹/Ð°Ñ ${c},\n\nÐœÑ‹ Ñ…Ð¾Ñ‚Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Ð’Ð°Ð¼ Ð¾Ð± Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð’Ð°ÑˆÐµÐ³Ð¾ Ñ‡Ð»ÐµÐ½ÑÑ‚Ð²Ð°.\n\n[Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ]\n\nÐ­Ñ‚Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð²ÑÑ‚ÑƒÐ¿Ð°ÑŽÑ‚ Ð² ÑÐ¸Ð»Ñƒ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾.\n\nÐ¡ Ð½Ð°Ð¸Ð»ÑƒÑ‡ÑˆÐ¸Ð¼Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸ÑÐ¼Ð¸,\nBILLIONAIRS Management`}},zh:{welcome:{subject:"æ¬¢è¿ŽåŠ å…¥ BILLIONAIRS",body:`å°Šæ•¬çš„ ${c}ï¼š\n\næˆ‘ä»¬çƒ­å¿±æ¬¢è¿Žæ‚¨åŠ å…¥ BILLIONAIRSã€‚\n\næ‚¨çš„ä¸“å±žæƒé™å·²æ¿€æ´»ï¼ŒçŽ°å¯ç«‹å³ä½¿ç”¨ã€‚ä½œä¸ºæˆ‘ä»¬ç§äººç½‘ç»œçš„æˆå‘˜ï¼Œæ‚¨å°†äº«æœ‰ç‹¬ç‰¹çš„ç‰¹æƒå’Œäººè„‰ã€‚\n\nå¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚\n\næ­¤è‡´æ•¬ç¤¼ï¼Œ\nBILLIONAIRS Management`},"payment-reminder":{subject:"ä»˜æ¬¾æé†’ â€” BILLIONAIRS ä¼šå‘˜èµ„æ ¼",body:`å°Šæ•¬çš„ ${c}ï¼š\n\næˆ‘ä»¬æ¸©é¦¨æé†’æ‚¨ï¼Œæ‚¨çš„ä¼šå‘˜è´¹å°šæœªæ”¯ä»˜ã€‚\n\nè¯·é€šè¿‡æ‚¨çš„ä»ªè¡¨æ¿å®Œæˆæ”¯ä»˜ï¼Œä»¥ç»§ç»­äº«å—æ‰€æœ‰ä¸“å±žåŠŸèƒ½çš„å®Œæ•´è®¿é—®æƒé™ã€‚\n\nå¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³» support@billionairs.luxuryã€‚\n\næ­¤è‡´æ•¬ç¤¼ï¼Œ\nBILLIONAIRS Management`},"account-issue":{subject:"å…³äºŽæ‚¨è´¦æˆ·çš„é‡è¦ä¿¡æ¯ â€” BILLIONAIRS",body:`å°Šæ•¬çš„ ${c}ï¼š\n\næˆ‘ä»¬å¸Œæœ›å°±æ‚¨çš„ BILLIONAIRS è´¦æˆ·ç›¸å…³äº‹å®œé€šçŸ¥æ‚¨ã€‚\n\n[è¯·åœ¨æ­¤æè¿°é—®é¢˜]\n\nè¯·å°½å¿«ä¸Žæˆ‘ä»¬è”ç³»ï¼Œä»¥ä¾¿è§£å†³æ­¤äº‹ã€‚\n\næ­¤è‡´æ•¬ç¤¼ï¼Œ\nBILLIONAIRS Management`},"membership-update":{subject:"BILLIONAIRS ä¼šå‘˜èµ„æ ¼æ›´æ–°",body:`å°Šæ•¬çš„ ${c}ï¼š\n\næˆ‘ä»¬å¸Œæœ›é€šçŸ¥æ‚¨ä¼šå‘˜èµ„æ ¼çš„æ›´æ–°ã€‚\n\n[æ›´æ–°è¯¦æƒ…]\n\nè¿™äº›å˜æ›´å³æ—¶ç”Ÿæ•ˆã€‚\n\næ­¤è‡´æ•¬ç¤¼ï¼Œ\nBILLIONAIRS Management`}},ja:{welcome:{subject:"BILLIONAIRS ã¸ã‚ˆã†ã“ã",body:`${c} æ§˜\n\nBILLIONAIRS ã¸ã‚ˆã†ã“ãã€‚å¿ƒã‚ˆã‚Šæ­“è¿Žç”³ã—ä¸Šã’ã¾ã™ã€‚\n\nãŠå®¢æ§˜ã®é™å®šã‚¢ã‚¯ã‚»ã‚¹ãŒæœ‰åŠ¹ã«ãªã‚Šã€ãŸã ã„ã¾ã‚ˆã‚Šã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¼šå“¡ã¨ã—ã¦ã€ç‹¬è‡ªã®ç‰¹æ¨©ã¨ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚\n\nã”è³ªå•ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ã„ã¤ã§ã‚‚ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n\næ•¬å…·\nBILLIONAIRS Management`},"payment-reminder":{subject:"ãŠæ”¯æ‰•ã„ã®ã”æ¡ˆå†… â€” BILLIONAIRS ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—",body:`${c} æ§˜\n\nä¼šå“¡è²»ã®ãŠæ”¯æ‰•ã„ãŒã¾ã å®Œäº†ã—ã¦ã„ãªã„ã“ã¨ã‚’ãŠçŸ¥ã‚‰ã›ã„ãŸã—ã¾ã™ã€‚\n\nã™ã¹ã¦ã®é™å®šæ©Ÿèƒ½ã¸ã®å®Œå…¨ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’å¼•ãç¶šããŠæ¥½ã—ã¿ã„ãŸã ããŸã‚ã«ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãŠæ”¯æ‰•ã„ã‚’ãŠæ¸ˆã¾ã›ãã ã•ã„ã€‚\n\nã”ä¸æ˜Žãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€support@billionairs.luxury ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚\n\næ•¬å…·\nBILLIONAIRS Management`},"account-issue":{subject:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢ã™ã‚‹é‡è¦ãªãŠçŸ¥ã‚‰ã› â€” BILLIONAIRS",body:`${c} æ§˜\n\nBILLIONAIRS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢ã™ã‚‹ä»¶ã«ã¤ã„ã¦ãŠçŸ¥ã‚‰ã›ã„ãŸã—ã¾ã™ã€‚\n\n[ã“ã“ã«å•é¡Œã‚’è¨˜è¿°ã—ã¦ãã ã•ã„]\n\næœ¬ä»¶ã®è§£æ±ºã®ãŸã‚ã€ãŠæ—©ã‚ã«ã”é€£çµ¡ãã ã•ã„ã€‚\n\næ•¬å…·\nBILLIONAIRS Management`},"membership-update":{subject:"BILLIONAIRS ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã®æ›´æ–°",body:`${c} æ§˜\n\nãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã®æ›´æ–°ã«ã¤ã„ã¦ãŠçŸ¥ã‚‰ã›ã„ãŸã—ã¾ã™ã€‚\n\n[æ›´æ–°ã®è©³ç´°]\n\nã“ã‚Œã‚‰ã®å¤‰æ›´ã¯å³åº§ã«æœ‰åŠ¹ã¨ãªã‚Šã¾ã™ã€‚\n\næ•¬å…·\nBILLIONAIRS Management`}},ar:{welcome:{subject:"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ BILLIONAIRS",body:`${c} Ø§Ù„Ø¹Ø²ÙŠØ²/Ø©ØŒ\n\nÙ†Ø±Ø­Ø¨ Ø¨Ùƒ ØªØ±Ø­ÙŠØ¨Ø§Ù‹ Ø­Ø§Ø±Ø§Ù‹ ÙÙŠ BILLIONAIRS.\n\nØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØµÙˆÙ„Ùƒ Ø§Ù„Ø­ØµØ±ÙŠ ÙˆÙ‡Ùˆ Ù…ØªØ§Ø­ Ù„Ùƒ Ø§Ù„Ø¢Ù†. Ø¨ØµÙØªÙƒ Ø¹Ø¶ÙˆØ§Ù‹ ÙÙŠ Ø´Ø¨ÙƒØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ©ØŒ ØªØ³ØªÙ…ØªØ¹ Ø¨Ø§Ù…ØªÙŠØ§Ø²Ø§Øª ÙˆØ§ØªØµØ§Ù„Ø§Øª ÙØ±ÙŠØ¯Ø©.\n\nØ¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø©ØŒ Ù†Ø­Ù† ÙÙŠ Ø®Ø¯Ù…ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.\n\nÙ…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ\nØ¥Ø¯Ø§Ø±Ø© BILLIONAIRS`},"payment-reminder":{subject:"ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¯ÙØ¹ â€” Ø¹Ø¶ÙˆÙŠØ© BILLIONAIRS",body:`${c} Ø§Ù„Ø¹Ø²ÙŠØ²/Ø©ØŒ\n\nÙ†ÙˆØ¯ ØªØ°ÙƒÙŠØ±Ùƒ Ø¨Ù„Ø·Ù Ø¨Ø£Ù† Ø±Ø³ÙˆÙ… Ø¹Ø¶ÙˆÙŠØªÙƒ Ù„Ø§ ØªØ²Ø§Ù„ Ù…Ø¹Ù„Ù‚Ø©.\n\nÙŠØ±Ø¬Ù‰ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø­ØµØ±ÙŠØ©.\n\nÙ„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ù„Ù‰ support@billionairs.luxury.\n\nÙ…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ\nØ¥Ø¯Ø§Ø±Ø© BILLIONAIRS`},"account-issue":{subject:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø© Ø­ÙˆÙ„ Ø­Ø³Ø§Ø¨Ùƒ â€” BILLIONAIRS",body:`${c} Ø§Ù„Ø¹Ø²ÙŠØ²/Ø©ØŒ\n\nÙ†ÙˆØ¯ Ø¥Ø¨Ù„Ø§ØºÙƒ Ø¨Ø´Ø£Ù† Ù…Ø³Ø£Ù„Ø© ØªØªØ¹Ù„Ù‚ Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ BILLIONAIRS.\n\n[ÙŠØ±Ø¬Ù‰ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§]\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† Ù„Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø£Ù„Ø©.\n\nÙ…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ\nØ¥Ø¯Ø§Ø±Ø© BILLIONAIRS`},"membership-update":{subject:"ØªØ­Ø¯ÙŠØ« Ø¹Ø¶ÙˆÙŠØªÙƒ ÙÙŠ BILLIONAIRS",body:`${c} Ø§Ù„Ø¹Ø²ÙŠØ²/Ø©ØŒ\n\nÙ†ÙˆØ¯ Ø¥Ø¨Ù„Ø§ØºÙƒ Ø¨ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø¹Ø¶ÙˆÙŠØªÙƒ.\n\n[ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«]\n\nØªØ³Ø±ÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙˆØ±Ø§Ù‹.\n\nÙ…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ\nØ¥Ø¯Ø§Ø±Ø© BILLIONAIRS`}}},h=p[d]||p.en;n.value=e,a.value="",s.value="",i.value="",o.textContent="0 Zeichen",r.querySelector("span").textContent="Senden",r.disabled=!1,s.oninput=()=>{const e=s.value.length;o.textContent=`${e} Zeichen`},window._adminEmailComposer={applyTemplate:()=>{const e=i.value;h[e]&&(a.value=h[e].subject,s.value=h[e].body,s.oninput())},send:async()=>{const n=a.value.trim(),i=s.value.trim();return n?i?(r.disabled=!0,r.querySelector("span").textContent="Senden...",await this.doSendEmail(e,n,i),r.querySelector("span").textContent="Gesendet âœ“",void setTimeout(()=>{t.classList.add("hidden")},1200)):(this.toast("Bitte Nachricht eingeben","error"),void s.focus()):(this.toast("Bitte Betreff eingeben","error"),void a.focus())}},t.classList.remove("hidden"),setTimeout(()=>a.focus(),100)}async doSendEmail(e,t,n){try{const a=this.getSession(),s=await this.authFetch("/api/admin-send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,subject:t,message:n})}),i=await s.json();s.ok&&i.success?this.toast("Email gesendet!","success"):this.toast(i.error||"Fehler","error")}catch(e){console.error("Send email error:",e),this.toast("Fehler","error")}}async updateMemberStatus(e,t,n){if(await this.confirmDialog(`Status von ${e} auf "${{paid:"Paid",pending:"Pending",free:"Free"}[t]}" Ã¤ndern?`))try{const a=this.getSession(),s=await this.authFetch("/api/admin-update-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,status:t})}),i=await s.json();if(s.ok&&i.success){const e={paid:{bg:"rgba(46,204,113,.15)",c:"#2ecc71",b:"#2ecc71"},pending:{bg:"rgba(243,156,18,.15)",c:"#f39c12",b:"#f39c12"},free:{bg:"rgba(220,53,69,.15)",c:"#DC3545",b:"#DC3545"}}[t];n.style.background=e.bg,n.style.color=e.c,n.style.borderColor=e.b,this.loadUsersData()}else this.toast(i.error||"Fehler","error"),this.loadUsersData()}catch(e){console.error(e),this.toast("Fehler","error"),this.loadUsersData()}else this.loadUsersData()}async deleteUser(e){if(await this.confirmDialog(`User ${e} wirklich lÃ¶schen?`,"ðŸ—‘ï¸"))try{const t=this.getSession(),n=await this.authFetch("/api/admin-delete-user",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(n.ok)this.toast("User gelÃ¶scht","success"),this.loadUsersData();else{const e=await n.json();this.toast(e.error,"error")}}catch(e){console.error(e),this.toast("Fehler","error")}}async blockUser(e){if(await this.confirmDialog(`${e} blockieren?`))try{const t=this.getSession(),n=await this.authFetch("/api/admin-block-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,action:"block"})}),a=await n.json();n.ok&&a.success?(this.toast(a.message,"success"),this.loadUsersData()):this.toast(a.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}async unblockUser(e){if(await this.confirmDialog(`${e} entsperren?`))try{const t=this.getSession(),n=await this.authFetch("/api/admin-block-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,action:"unblock"})}),a=await n.json();n.ok&&a.success?(this.toast(a.message,"success"),this.loadUsersData()):this.toast(a.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}async reset2FA(e){if(await this.confirmDialog(`2FA fuer ${e} zuruecksetzen? Der User muss 2FA danach neu einrichten.`,"ðŸ”"))try{const t=this.getSession(),n=await this.authFetch("/api/admin-reset-2fa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await n.json();n.ok&&a.success?(this.toast("2FA zurueckgesetzt","success"),this.loadUsersData()):this.toast(a.error||"Fehler","error")}catch(e){console.error(e),this.toast("Fehler beim 2FA-Reset","error")}}async createMember(){const e=document.getElementById("newMemberEmail").value.trim().toLowerCase(),t=document.getElementById("newMemberPassword").value,n=document.getElementById("newMemberName").value.trim(),a=document.getElementById("newMemberPaid").checked,s=document.getElementById("createMemberResult");if(e&&t)if(t.length<8)s.innerHTML='<span style="color:#e74c3c;">Passwort min. 8 Zeichen</span>';else{s.innerHTML='<span style="color:#E8C4A8;">Erstelle...</span>';try{const i=this.getSession(),o=await this.authFetch("/api/admin-create-member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,fullName:n,markAsPaid:a})}),r=await o.json();o.ok&&r.success?(s.innerHTML=`<span style="color:#2ecc71;">âœ… ${this.escapeHtml(r.message)}</span>`,document.getElementById("newMemberEmail").value="",document.getElementById("newMemberPassword").value="",document.getElementById("newMemberName").value="",this.loadUsersData()):s.innerHTML=`<span style="color:#e74c3c;">âŒ ${this.escapeHtml(r.error||"Fehler")}</span>`}catch(e){console.error(e),s.innerHTML='<span style="color:#e74c3c;">âŒ Verbindungsfehler</span>'}}else s.innerHTML='<span style="color:#e74c3c;">Email und Passwort erforderlich</span>'}renderIndividualUserControls(e){const t=document.getElementById("individualUserControls");if(!t)return;t.innerHTML="";const n=e.filter(e=>e.email!==this.ceoEmail),a=document.getElementById("memberCount");if(a&&(a.textContent=`${n.length} Members`),!n.length)return void(t.innerHTML='<p style="color:#888;text-align:center;padding:1rem;">Keine Members</p>');const s=Date.now();n.forEach(e=>{const n=this.escapeHtml(e.email),a=this.escapeHtml(e.full_name||e.name||"")||n.split("@")[0],i=e.last_seen?new Date(e.last_seen):null,o=i&&s-i.getTime()<3e5,r=i?this.formatTimeAgo(i):"Nie",l=e.paid_at?new Date(e.paid_at).toLocaleDateString("de-CH"):"â€”",d=e.created_at?new Date(e.created_at).toLocaleDateString("de-CH"):"â€”",c=document.createElement("div");c.className="user-control-card",c.dataset.userEmail=e.email.toLowerCase(),c.dataset.userName=(e.full_name||e.name||"").toLowerCase(),c.innerHTML=`\n                <div class="user-control-header" style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">\n                    <div style="flex:1;">\n                        <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;">\n                            <span style="width:8px;height:8px;border-radius:50%;background:${o?"#2ecc71":"#444"};display:inline-block;${o?"box-shadow:0 0 6px rgba(46,204,113,.5);":""}"></span>\n                            <span style="font-weight:600;font-size:14px;color:#E8C4A8;">${a}</span>\n                        </div>\n                        <div style="font-size:11px;color:#777;margin-left:14px;">${n}</div>\n                    </div>\n                    <span class="user-control-status ${e.has_paid?"paid":"free"}">${e.has_paid?"Paid":"Free"}</span>\n                </div>\n                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:8px 0;padding:8px;background:rgba(255,255,255,.015);border-radius:6px;">\n                    <div style="text-align:center;"><div style="font-size:9px;color:#666;text-transform:uppercase;">Reg.</div><div style="font-size:12px;color:#bbb;">${d}</div></div>\n                    <div style="text-align:center;"><div style="font-size:9px;color:#666;text-transform:uppercase;">Login</div><div style="font-size:12px;color:${o?"#2ecc71":"#bbb"};">${r}</div></div>\n                    <div style="text-align:center;"><div style="font-size:9px;color:#666;text-transform:uppercase;">Payment</div><div style="font-size:12px;color:${e.paid_at?"#2ecc71":"#e74c3c"};">${l}</div></div>\n                </div>\n                <div class="easter-egg-features">\n                    ${["eye","chat"].map(t=>{const n="chat"===t?e.chat_ready||e.chat_unlocked:e[t+"_unlocked"];return`<div class="feature-control">\n                            <div class="feature-control-header">\n                                <span class="feature-name">${"eye"===t?"ðŸ‘ï¸":"ðŸ’¬"} ${t.charAt(0).toUpperCase()+t.slice(1)}</span>\n                                <div class="feature-status">\n                                    <span class="status-indicator ${n?"unlocked":"locked"}"></span>\n                                    <span class="status-text">${n?"On":"Off"}</span>\n                                </div>\n                            </div>\n                            <div class="feature-buttons">\n                                <button class="feature-toggle-btn unlock" data-action="toggle" data-email="${this.safeAttr(e.email)}" data-feature="${t}" data-unlock="true" ${n?"disabled":""}>On</button>\n                                <button class="feature-toggle-btn lock" data-action="toggle" data-email="${this.safeAttr(e.email)}" data-feature="${t}" data-unlock="false" ${n?"":"disabled"}>Off</button>\n                            </div>\n                        </div>`}).join("")}\n                </div>\n            `,t.appendChild(c)}),t.addEventListener("click",e=>{const t=e.target.closest('[data-action="toggle"]');t&&!t.disabled&&this.toggleFeature(t.dataset.email,t.dataset.feature,"true"===t.dataset.unlock)});const i=document.getElementById("easterEggUserSearch");if(i){const e=i.cloneNode(!0);i.parentNode.replaceChild(e,i),e.addEventListener("input",e=>{const s=e.target.value.toLowerCase();let i=0;t.querySelectorAll(".user-control-card").forEach(e=>{const t=e.dataset.userEmail.includes(s)||e.dataset.userName.includes(s);e.style.display=t?"":"none",t&&i++}),a&&(a.textContent=s?`${i}/${n.length}`:`${n.length} Members`)})}}async toggleFeature(e,t,n){try{const a=this.getSession(),s=await this.authFetch("/api/admin-toggle-easter-eggs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.email}`},body:JSON.stringify({action:n?"unlock":"lock",feature:t,email:e})});if(s.ok)this.loadUsersData();else{const e=await s.json();this.toast(e.error||"Fehler","error")}}catch(e){console.error(e),this.toast("Fehler","error")}}setupBulkEasterEggControls(){document.querySelectorAll(".bulk-unlock-btn, .bulk-lock-btn").forEach(e=>{e.addEventListener("click",()=>this.handleBulkAction(e.dataset.action,e.dataset.feature))})}async handleBulkAction(e,t){if(await this.confirmDialog(`${"unlock-all"===e?"UNLOCK":"LOCK"} ${{pyramid:"Pyramid",eye:"Eye",chat:"Chat",all:"Alle Features"}[t]} fÃ¼r ALLE Members?`))try{const n=this.getSession(),a=await this.authFetch("/api/admin-toggle-easter-eggs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.email}`},body:JSON.stringify({action:e,feature:t})}),s=await a.json();a.ok?(this.toast(`${s.message} (${s.affectedUsers} User)`,"success"),this.loadUsersData()):this.toast(s.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}async loadChatData(){const e=document.querySelector("main");this.showLoading(e,"Lade Chat...");try{const e=this.getSession(),t=await this.authFetch("/api/chat?ceo=true");if(!t.ok)return;const n=await t.json();if(!n.messages||!Array.isArray(n.messages))return document.getElementById("totalMessages").textContent="0",document.getElementById("todayMessages").textContent="0",void(document.getElementById("chatUsers").textContent="0");document.getElementById("totalMessages").textContent=n.messages.length;const a=(new Date).toDateString();document.getElementById("todayMessages").textContent=n.messages.filter(e=>new Date(e.created_at).toDateString()===a).length,document.getElementById("chatUsers").textContent=new Set(n.messages.map(e=>e.email)).size;const s=document.getElementById("adminChatMessages");s.innerHTML="",n.messages.reverse().forEach(e=>{const t=document.createElement("div");t.className="admin-message",t.innerHTML=`\n                    <div class="msg-header">\n                        <strong>${this.escapeHtml(e.username)}</strong>\n                        <span>${this.escapeHtml(e.email)}</span>\n                        <span>${new Date(e.created_at).toLocaleString("de-CH")}</span>\n                    </div>\n                    <div class="msg-content">${this.escapeHtml(e.message||"[File]")}</div>\n                    <button class="delete-msg-btn" data-action="delete-msg" data-id="${e.id}">LÃ¶schen</button>\n                `,s.appendChild(t)});const i=document.getElementById("refreshChat");if(i){const e=i.cloneNode(!0);i.parentNode.replaceChild(e,i),e.addEventListener("click",()=>{this._cacheInvalidate("chat"),this.loadChatData()})}s.addEventListener("click",e=>{const t=e.target.closest('[data-action="delete-msg"]');t&&this.deleteMessage(parseInt(t.dataset.id))}),this._cacheSet("chat",!0)}catch(e){console.error("Chat error:",e)}finally{this.hideLoading(document.querySelector("main"))}}async deleteMessage(e){if(await this.confirmDialog("Nachricht lÃ¶schen?","ðŸ—‘ï¸"))try{const t=this.getSession(),n=await this.authFetch("/api/admin-delete-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:e})});if(n.ok)this.toast("Nachricht geloescht","success"),this.loadChatData();else{const e=await n.json().catch(()=>({}));this.toast(e.error||"Fehler beim Loeschen","error")}}catch(e){console.error(e),this.toast("Verbindungsfehler","error")}}async loadPaymentsData(){const e=document.querySelector("main");this.showLoading(e,"Lade Zahlungen...");try{const e=this.getSession(),t=await this.authFetch("/api/admin-payments"),n=await t.json(),a=e=>new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);document.getElementById("totalRevenue").textContent=a(n.totalRevenue||0),document.getElementById("stripePayments").textContent=n.stripeCount||0,document.getElementById("cryptoPayments").textContent=n.cryptoCount||0;const s=document.getElementById("paymentsTableBody");s.innerHTML="",n.payments&&n.payments.length?n.payments.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n                        <td data-label="Datum">${new Date(e.created_at).toLocaleDateString("de-CH")}</td>\n                        <td data-label="Email">${this.escapeHtml(e.email)}</td>\n                        <td data-label="Betrag">${a(e.amount)}</td>\n                        <td data-label="Methode"><span class="payment-method-badge ${e.method}">${e.method}</span></td>\n                        <td data-label="Status"><span class="status-badge ${"refunded"===e.status?"refunded":"paid"}">${e.status}</span></td>\n                    `,s.appendChild(t)}):s.innerHTML='<tr><td colspan="5" style="text-align:center;color:#888;">Keine Zahlungen</td></tr>',this._cacheSet("payments",!0)}catch(e){console.error("Payments error:",e),document.getElementById("totalRevenue").textContent="CHF 0"}finally{this.hideLoading(document.querySelector("main"))}}async loadStatsData(){try{const e=this.getSession(),t=await this.authFetch("/api/admin-stats"),n=await t.json();document.getElementById("statsRegistered").textContent=n.registered||0,document.getElementById("statsPaid").textContent=n.paid||0,document.getElementById("statsPyramid").textContent=n.pyramid||0,document.getElementById("statsEye").textContent=n.eye||0,document.getElementById("statsChat").textContent=n.chat||0}catch(e){console.error("Stats error:",e)}}async loadEnhancedAnalytics(){const e=this.getSession();if(e)try{const t=await this.authFetch("/api/admin-analytics");if(!t.ok)return;const n=await t.json(),a=document.getElementById("analyticsSection");if(!a)return;a.innerHTML=`\n                <h3>Enhanced Analytics</h3>\n                <div class="analytics-grid">\n                    <div class="analytics-card">\n                        <h4>Revenue</h4>\n                        <p>Total: CHF ${(n.revenue?.total_revenue||0).toLocaleString()}</p>\n                        <p>Durchschnitt: CHF ${(n.revenue?.avg_payment||0).toLocaleString()}</p>\n                        <p>Conversion: ${n.conversion?.conversionRate||0}%</p>\n                    </div>\n                    <div class="analytics-card">\n                        <h4>User Engagement</h4>\n                        <p>Aktiv (30d): ${n.users?.activeUsers||0}</p>\n                        <p>Neu (7d): ${n.users?.recentRegistrations||0}</p>\n                    </div>\n                    <div class="analytics-card">\n                        <h4>Chat</h4>\n                        <p>Messages: ${n.chat?.total_messages||0}</p>\n                        <p>User: ${n.chat?.unique_users||0}</p>\n                    </div>\n                </div>\n            `}catch(e){console.error("Analytics error:",e)}}async checkEmergencyMode(){try{const e=await fetch("/api/check-emergency"),t=await e.json();this.updateEmergencyButton(t.isActive)}catch(e){console.error(e)}}updateEmergencyButton(e){const t=document.getElementById("emergencyBtn"),n=t.querySelector(".emergency-text");t.dataset.active=e,n.textContent=e?"EMERGENCY: AN":"Emergency: OFF"}async toggleEmergencyMode(){const e="true"===document.getElementById("emergencyBtn").dataset.active,t=e?"Website ONLINE bringen?":"EMERGENCY SHUTDOWN aktivieren?\nAlle User sehen 404!";if(await this.confirmDialog(t,e?"âœ…":"ðŸš¨"))try{const t=this.getSession();(await this.authFetch("/api/admin-emergency",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.ceoEmail,password:t?.password||"",mode:e?"deactivate":"activate"})})).ok&&(this.updateEmergencyButton(!e),this.toast(e?"Website ONLINE":"Emergency Mode AKTIV",e?"success":"warning"))}catch(e){console.error(e)}}show2FAPrompt(e,t){this._pending2FA={email:e,password:t};const n=document.getElementById("adminLoginForm"),a=document.getElementById("admin2FAModal");if(n&&(n.style.display="none"),a){a.style.display="block",document.querySelectorAll(".admin-2fa-digit").forEach(e=>{e.value="",e.classList.remove("filled")});const e=document.getElementById("admin2FAError");e&&(e.style.display="none"),document.getElementById("adminBackupSection").style.display="none",document.getElementById("admin2FADigits").style.display="flex",document.getElementById("admin2FAVerifyBtn").style.display="block";const t=a.querySelector('.admin-2fa-digit[data-index="0"]');t&&setTimeout(()=>t.focus(),150)}this._init2FAModalHandlers()}_init2FAModalHandlers(){if(this._2faHandlersInit)return;this._2faHandlersInit=!0;const e=document.querySelectorAll(".admin-2fa-digit");e.forEach((t,n)=>{t.addEventListener("input",t=>{const a=t.target.value.replace(/\D/g,"");if(t.target.value=a,1===a.length){if(t.target.classList.add("filled"),n<5&&e[n+1].focus(),5===n){6===Array.from(e).map(e=>e.value).join("").length&&setTimeout(()=>this._submit2FACode(),200)}}else t.target.classList.remove("filled")}),t.addEventListener("keydown",t=>{"Backspace"===t.key&&!t.target.value&&n>0&&(e[n-1].focus(),e[n-1].value="",e[n-1].classList.remove("filled"))}),t.addEventListener("paste",t=>{t.preventDefault();const n=(t.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");if(n.length>=6){for(let t=0;t<6;t++)e[t].value=n[t],e[t].classList.add("filled");setTimeout(()=>this._submit2FACode(),300)}})}),document.getElementById("admin2FAVerifyBtn")?.addEventListener("click",()=>this._submit2FACode()),document.getElementById("adminBackupCodeLink")?.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("adminBackupSection"),n=document.getElementById("admin2FADigits"),a=document.getElementById("admin2FAVerifyBtn");"none"===t.style.display?(t.style.display="block",n.style.display="none",a.style.display="none",e.target.textContent="Authenticator Code verwenden",document.getElementById("adminBackupCodeInput").focus()):(t.style.display="none",n.style.display="flex",a.style.display="block",e.target.textContent="Backup Code verwenden",document.querySelector('.admin-2fa-digit[data-index="0"]').focus())}),document.getElementById("adminBackupVerifyBtn")?.addEventListener("click",()=>this._submitBackupCode()),document.getElementById("admin2FABack")?.addEventListener("click",e=>{e.preventDefault(),this._hide2FAModal()})}_hide2FAModal(){const e=document.getElementById("adminLoginForm"),t=document.getElementById("admin2FAModal");e&&(e.style.display="block"),t&&(t.style.display="none"),this._pending2FA=null}_show2FAError(e){const t=document.getElementById("admin2FAError");t&&(t.textContent=e,t.style.display="block")}async _submit2FACode(){const e=document.querySelectorAll(".admin-2fa-digit"),t=Array.from(e).map(e=>e.value).join("");6===t.length?this._pending2FA&&await this.verify2FAAndLogin(this._pending2FA.email,this._pending2FA.password,t):this._show2FAError("6-stelliger Code erforderlich")}async _submitBackupCode(){const e=document.getElementById("adminBackupCodeInput")?.value.trim();e?this._pending2FA&&await this.verify2FAAndLogin(this._pending2FA.email,this._pending2FA.password,e):this._show2FAError("Backup Code eingeben")}async verify2FAAndLogin(e,t,n){const a=document.getElementById("admin2FAVerifyBtn"),s=document.getElementById("adminBackupVerifyBtn");a&&(a.disabled=!0),s&&(s.disabled=!0);try{const a=await fetch("/api/admin-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,twoFactorCode:n})});if(a.ok){const e=await a.json();this.setSession(e.email,e.sessionToken),this._hide2FAModal(),this.showDashboard(e.email)}else{this._show2FAError("Ungueltiger Code - erneut versuchen"),document.querySelectorAll(".admin-2fa-digit").forEach(e=>{e.value="",e.classList.remove("filled")});const e=document.querySelector('.admin-2fa-digit[data-index="0"]');e&&e.focus()}}catch(e){console.error(e),this._show2FAError("Verbindungsfehler")}finally{a&&(a.disabled=!1),s&&(s.disabled=!1)}}async loadSecurityTab(){await this.load2FAStatus(),await this.loadBlockedIPs(),this.loadRateLimitStats(),this.setup2FAHandlers(),this.setupIPBlockingHandlers()}async load2FAStatus(){try{const e=this.getSession(),t=await this.authFetch("/api/admin-2fa-setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.ceoEmail,password:e?.password||"",action:"status"})});(await t.json()).enabled?(document.getElementById("2faStatusText").textContent="2FA: Aktiviert âœ…",document.getElementById("enable2FA").classList.add("hidden"),document.getElementById("disable2FA").classList.remove("hidden")):(document.getElementById("2faStatusText").textContent="2FA: Deaktiviert",document.getElementById("enable2FA").classList.remove("hidden"),document.getElementById("disable2FA").classList.add("hidden"))}catch(e){console.error(e)}}setup2FAHandlers(){const e=document.getElementById("enable2FA"),t=document.getElementById("disable2FA"),n=document.getElementById("verify2FA");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>this.start2FASetup())}if(t){const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",()=>this.disable2FA())}if(n){const e=n.cloneNode(!0);n.parentNode.replaceChild(e,n),e.addEventListener("click",()=>this.verify2FASetup())}}async start2FASetup(){try{const e=this.getSession(),t=await this.authFetch("/api/admin-2fa-setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.ceoEmail,password:e?.password||"",action:"generate"})}),n=await t.json();if(n.success){document.getElementById("twoFactorSetup").classList.remove("hidden");const e=document.getElementById("qrCodeCanvas");e.innerHTML="",new QRCode(e,{text:n.qrCodeUrl,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M});document.getElementById("backupCodes").style.display="block",document.getElementById("backupCodesList").innerHTML=n.backupCodes.map(e=>`<div class="backup-code">${e}</div>`).join(""),document.getElementById("enable2FA").classList.add("hidden")}}catch(e){console.error(e),this.toast("2FA Setup fehlgeschlagen","error")}}async verify2FASetup(){const e=document.getElementById("verificationCode").value;if(e&&6===e.length)try{const t=this.getSession(),n=await this.authFetch("/api/admin-2fa-setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.ceoEmail,password:t?.password||"",action:"verify",code:e})});(await n.json()).success?(this.toast("2FA aktiviert!","success"),location.reload()):this.toast("UngÃ¼ltiger Code","error")}catch(e){console.error(e)}else this.toast("6-stelliger Code erforderlich","warning")}async disable2FA(){const e=prompt("Code/Backup-Code eingeben:");if(e)try{const t=this.getSession(),n=await this.authFetch("/api/admin-2fa-setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.ceoEmail,password:t?.password||"",action:"disable",code:e})});(await n.json()).success?(this.toast("2FA deaktiviert","success"),location.reload()):this.toast("UngÃ¼ltiger Code","error")}catch(e){console.error(e)}}setupIPBlockingHandlers(){const e=document.getElementById("blockIpBtn");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>this.blockIP())}}async blockIP(){const e=document.getElementById("blockIpAddress").value.trim(),t=document.getElementById("blockReason").value.trim(),n=document.getElementById("blockDuration").value;if(e)try{const a=await this.authFetch("/api/block-ip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:e,reason:t,duration:n?parseInt(n):null,adminEmail:this.ceoEmail})});(await a.json()).success&&(this.toast("IP blockiert","success"),document.getElementById("blockIpAddress").value="",document.getElementById("blockReason").value="",this.loadBlockedIPs())}catch(e){console.error(e)}else this.toast("IP-Adresse eingeben","warning")}async loadBlockedIPs(){try{const e=this.getSession(),t=await this.authFetch("/api/admin-blocked-ips"),n=await t.json();if(n.success){const e=document.getElementById("blockedIpsList");if(!n.blockedIps.length)return void(e.innerHTML='<p style="color:#888;text-align:center;padding:1rem;">Keine blockierten IPs</p>');e.innerHTML=n.blockedIps.map(e=>`\n                    <div class="blocked-ip-item">\n                        <div class="blocked-ip-info">\n                            <div class="blocked-ip-address">${e.ip}</div>\n                            <div class="blocked-ip-reason">${e.reason||""}</div>\n                            <div class="blocked-ip-meta">${new Date(e.blocked_at).toLocaleString("de-CH")} | ${e.expires_at?"Bis: "+new Date(e.expires_at).toLocaleString("de-CH"):"Permanent"}</div>\n                        </div>\n                        <span class="ip-status-badge ${e.is_active?"active":"expired"}">${e.is_active?"AKTIV":"EXPIRED"}</span>\n                        ${e.is_active?`<button class="btn-sm btn-green" data-action="unblock-ip" data-ip="${this.safeAttr(e.ip)}">Unblock</button>`:""}\n                    </div>\n                `).join(""),e.addEventListener("click",e=>{const t=e.target.closest('[data-action="unblock-ip"]');t&&this.unblockIP(t.dataset.ip)})}}catch(e){console.error(e)}}async unblockIP(e){if(await this.confirmDialog(`IP ${e} entsperren?`))try{const t=await this.authFetch("/api/block-ip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:e,action:"unblock",adminEmail:this.ceoEmail})});(await t.json()).success&&(this.toast("IP entsperrt","success"),this.loadBlockedIPs())}catch(e){console.error(e)}}loadRateLimitStats(){document.getElementById("totalRequests").textContent="â€”",document.getElementById("blockedRequests").textContent="â€”",document.getElementById("autoBlockedIps").textContent="â€”"}async loadAuditTab(){await this.loadAuditLogs();const e=document.getElementById("refreshAuditLogs");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>this.loadAuditLogs())}}async loadAuditLogs(){const e=document.getElementById("auditActionFilter")?.value||"",t=document.getElementById("auditLimit")?.value||100;try{const n=`/api/admin-audit-logs?limit=${t}${e?"&action="+e:""}`,a=this.getSession(),s=await this.authFetch(n),i=await s.json();if(i.success){document.getElementById("auditStats").innerHTML=(i.stats||[]).map(e=>`\n                    <div class="stat-item"><span class="stat-label">${e.action}</span><span class="stat-value">${e.count}</span></div>\n                `).join("");const e=document.getElementById("auditLogsList");if(!i.logs.length)return void(e.innerHTML='<p style="color:#888;text-align:center;padding:1rem;">Keine Logs</p>');e.innerHTML=i.logs.map(e=>`\n                    <div class="audit-log-item">\n                        <div class="audit-timestamp">${new Date(e.timestamp).toLocaleString("de-CH")}</div>\n                        <div class="audit-action">${e.action}</div>\n                        <div><div class="audit-user">${e.user_email||"System"}</div><div class="audit-ip">${e.ip||""}</div></div>\n                        <div class="audit-details">${e.details||"â€”"}</div>\n                    </div>\n                `).join("")}}catch(e){console.error("Audit error:",e)}}setupExportButtons(){const e=(e,t,n,a)=>{const s=document.querySelector(e);if(s&&!s.querySelector(".export-buttons")){const e=document.createElement("div");e.className="export-buttons";const i=document.createElement("button");i.className="export-btn",i.textContent=a,i.addEventListener("click",()=>this.exportData(t,n)),e.appendChild(i),s.insertBefore(e,s.firstChild)}};e("#tab-payments","payments","csv","CSV Export"),e("#auditTab","audit-logs","json","JSON Export")}async exportData(e,t){const n=this.getSession();if(!n)return this.toast("Session abgelaufen","error"),void location.reload();try{const a=await this.authFetch(`/api/admin-export?type=${e}&format=${t}`);if(!a.ok)throw new Error("Export fehlgeschlagen");const s=await a.blob(),i=a.headers.get("Content-Disposition"),o=i?.match(/filename="(.+)"/),r=o?o[1]:`export-${e}.${t}`,l=document.createElement("a");l.href=URL.createObjectURL(s),l.download=r,l.click(),URL.revokeObjectURL(l.href)}catch(e){console.error(e),this.toast("Export fehlgeschlagen","error")}}setupBroadcastButton(){}showBroadcastModal(){const e=document.createElement("div");e.className="modal-overlay",e.id="broadcastModal",e.innerHTML='\n            <div class="modal-content broadcast-modal">\n                <h2>Broadcast Notification</h2>\n                <form id="broadcastForm">\n                    <div class="form-group"><label>Zielgruppe:</label><select id="broadcastAudience" required><option value="all">Alle</option><option value="paid">Paid</option><option value="unpaid">Free</option></select></div>\n                    <div class="form-group"><label>Titel:</label><input type="text" id="broadcastTitle" maxlength="50" required></div>\n                    <div class="form-group"><label>Nachricht:</label><textarea id="broadcastMessage" maxlength="200" rows="3" required></textarea></div>\n                    <div class="form-actions">\n                        <button type="submit" class="btn-primary">Senden</button>\n                        <button type="button" class="btn-secondary" id="broadcastCancel">Abbrechen</button>\n                    </div>\n                </form>\n            </div>\n        ',document.body.appendChild(e),document.getElementById("broadcastForm").addEventListener("submit",e=>{e.preventDefault(),this.sendBroadcast()}),document.getElementById("broadcastCancel").addEventListener("click",()=>e.remove())}async sendBroadcast(){const e=this.getSession(),t=document.getElementById("broadcastTitle").value.trim(),n=document.getElementById("broadcastMessage").value.trim(),a=document.getElementById("broadcastAudience").value;if(await this.confirmDialog(`Broadcast an "${a}" senden?`))try{const s=await this.authFetch("/api/admin-broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,message:n,url:"/",icon:"/assets/images/icon-192x192.png",targetAudience:a})}),i=await s.json();s.ok&&i.success?(this.toast(`Gesendet: ${i.sent}/${i.total}`,"success"),document.getElementById("broadcastModal").remove()):this.toast(i.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}async deleteAllUsers(){const e=prompt('âš ï¸ ALLE User lÃ¶schen (ausser CEO)?\n\nTippe "DELETE ALL":');if("DELETE ALL"===e){if(await this.confirmDialog("LETZTE WARNUNG!\nAlle User permanent lÃ¶schen?","ðŸš¨"))try{const e=this.getSession(),t=await this.authFetch("/api/admin-delete-users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminEmail:e.email,adminPassword:e.password})}),n=await t.json();t.ok&&n.success?(this.toast(`${n.deleted_count} User gelÃ¶scht`,"success"),this.loadUsersData()):this.toast(n.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}else null!==e&&this.toast("Abgebrochen","info")}async createTestUsers(){if(await this.confirmDialog("2 Test-User erstellen?"))try{const e=this.getSession(),t=await this.authFetch("/api/create-test-users"),n=await t.json();t.ok&&n.success?(this.toast(n.message,"success"),this.loadUsersData()):this.toast(n.error,"error")}catch(e){console.error(e),this.toast("Fehler","error")}}}const adminPanel=new AdminPanel;window.admin=adminPanel;