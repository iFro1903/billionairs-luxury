class AuthManager{constructor(){const e=localStorage.getItem("billionairs_user");try{this.user=e?JSON.parse(e):null}catch(e){console.warn("Corrupt user data in localStorage, resetting."),localStorage.removeItem("billionairs_user"),this.user=null}localStorage.removeItem("billionairs_token"),localStorage.removeItem("auth_token"),localStorage.removeItem("authToken")}async register(e,t,r="",a=""){try{const o=localStorage.getItem("billionairs_lang")||navigator.language?.split("-")[0]||"en",s=await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"register",email:e,password:t,firstName:r,lastName:a,language:o})}),i=await s.json();if(!i.success)throw new Error(i.error||i.message||"Registration failed");return i}catch(e){throw console.error("Registration error:",e),e}}async login(e,t,r=null){try{const a={action:"login",email:e,password:t,language:localStorage.getItem("billionairs_lang")||navigator.language?.split("-")[0]||"en"};r&&(a.twoFactorCode=r);const o=await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)}),s=await o.json();if(s.requiresTwoFactor)return s;if(!s.success)throw new Error(s.error||s.message||"Login failed");return this.user=s.user,localStorage.setItem("billionairs_user",JSON.stringify(s.user)),s}catch(e){throw console.error("Login error:",e),e}}async verifySession(){try{const e=await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"verify"})}),t=await e.json();return t.success?(this.user=t.user,localStorage.setItem("billionairs_user",JSON.stringify(t.user)),!0):(this.logout(),!1)}catch(e){return console.error("Session verification error:",e),this.logout(),!1}}async logout(){try{await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"logout"})})}catch(e){console.error("Logout error:",e)}finally{this.user=null,localStorage.removeItem("billionairs_user"),localStorage.removeItem("billionairs_token"),localStorage.removeItem("auth_token"),localStorage.removeItem("authToken"),localStorage.removeItem("user_data")}}async updatePaymentStatus(){try{const e=await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"update_payment"})}),t=await e.json();if(!t.success)throw new Error(t.error||t.message||"Payment update failed");return this.user=t.user,localStorage.setItem("billionairs_user",JSON.stringify(t.user)),t}catch(e){throw console.error("Payment update error:",e),e}}isLoggedIn(){return!!this.user}hasPaid(){return this.user&&"paid"===this.user.paymentStatus}getUser(){return this.user}}window.authManager=new AuthManager;